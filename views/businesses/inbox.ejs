<% var counter=1%>
<% var clientCurrentUser = false;%>
	<!DOCTYPE HTML>
	<html lang="en-US">

	<head>
		<!--Metatags-->
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatble" content="ie=edge" />

		<!-- Google Tag Manager -->
		<script>(function (w, d, s, l, i) {
				w[l] = w[l] || []; w[l].push({
					'gtm.start':
						new Date().getTime(), event: 'gtm.js'
				}); var f = d.getElementsByTagName(s)[0],
					j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
						'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
			})(window, document, 'script', 'dataLayer', 'GTM-T23WPNV');</script>
		<!-- End Google Tag Manager -->

		<!--Website Title-->
		<title>Gabazzo | Inbox</title>
		<!--Calling Favicon-->
		<link rel="icon" href="../images/layout/favicon.png" />
		<link rel="shortcut icon" href="../images/layout/favicon.ico" />
		<!--FontAwesome CDN-->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
		<!--Bootstrap v4.5.3 CSS FILE-->
		<link href="../css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<!--Fonts Are Loads From Here-->
		<link href="../fonts/fontschat.css" rel="stylesheet" type="text/css" />
		<!--Gabazzo Common CSS File-->
		<link rel="stylesheet" href="../css/gabazzo.common.css" />
		<!--Normalize CSS File-->
		<link rel="stylesheet" href="../css/normalize.css" />
		<!--Main Stylesheet-->
		<link rel="stylesheet" href="../css/updatedStyles.css" />
		<!--Stylesheet For The Responsiveness-->
		<link rel="stylesheet" href="../css/responsive.css" />
		<!--Stylesheet For The Night Mode-->
		<link href="../css/chatnight.mode.css" rel="stylesheet" type="text/css" />

	</head>

	<body>

		<!--===== Markup For "Header" Starts From Here =====-->
		<header class="header">
			<nav class="navbar navbar-expand-lg">
				<div class="container">
					<div class="logo_mode_switching">
						<ul>
							<li>
								<a href="/" class="navbar-brand"><img src="../images/layout/gabazzo_logo_white.png"
										class="img-fluid" alt="" /></a>
							</li>
							<li>
								<a class="mode_icon" href="javascript:void(0)">
									<img src="../images/layout/mode_icon_night.png" class="img-fluid night_icon"
										title="Night Mode" data-toggle="tooltip" alt="" />
									<img src="../images/layout/mode_icon_day.png" class="img-fluid day_icon"
										title="Day Mode" data-toggle="tooltip" alt="" />
								</a>
							</li>
						</ul>
					</div>

					<div class="members_navbar">
						<div class="mobile_search_btn_menubar">
							<div class="cp_search_btn dropdown">
								<a href="javascript:void(0)" data-target="#companySearchBar" data-toggle="dropdown"
									class="nav-link"><img src="../images/layout/search_icon_white.png" class="img-fluid"
										alt="" /></a>

								<div class="dropdown-menu company_search_down" aria-labelledby="companySearchBar">
									<form action="">
										<div class="company_search_field">
											<input id="myInput" type="search" placeholder="Search..."
												class="form-control" />
											<button class="btn" type="submit">
												<img src="../images/layout/search_icon_black.png" class="black_icon"
													alt="" />
												<img src="../images/layout/search_icon_white.png" class="white_icon"
													alt="" />
											</button>
										</div>
									</form>
								</div>
							</div>

							<button class="navbar-toggler" data-target="#responsive-bar" data-toggle="collapse">
								<div class="humbergur_icon">
									<span></span><span></span><span></span><span></span>
								</div>
							</button>

							<% if(currentUser) { %>
								<a href="javascript:void(0)" class="nav-link profile_pic_link membersProfilePic">
									<div class="profile_pic">
										<% if (currentUser?.isCompany) { %>
											<script>
												clientCurrentUser = "<%= currentUser.isCompany %>"
											</script>
											<% if(currentUser.logo) { %>
												<img src="<%= currentUser.logo %>" class="img-fluid" alt="" />
												<% } else {%>
													<img src="../images/man.png" class="img-fluid" alt="" />
													<% }%>
														<% } else { %>
															<script>
																clientCurrentUser = false;
															</script>
															<% if(currentUser?.profilePicture) {%>
																<img src="<%= currentUser.profilePicture %>"
																	class="img-fluid"
																	alt="<%= currentUser.username %>" />
																<%} else {%>
																	<img src="../images/man.png" class="img-fluid"
																		alt="<%= currentUser.username %>" />
																	<% }%>
																		<% } %>
																			<span
																				class="activity_status online_status"></span>
									</div>
								</a>
								<% } %>
						</div>
					</div>
					<div class="collapse navbar-collapse" id="responsive-bar">
						<div class="menus ml-auto">
							<ul class="navbar-nav services_menu">
								<li class="nav-item dropdown">
									<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Construction
										Services</a>
									<div class="dropdown-menu">
										<ul class="dropdown_column">
											<li>
												<a href="/search?category=roofing services"
													class="dropdown-item">Roofing</a>
											</li>
											<li>
												<a href="/search?category=landscaping services"
													class="dropdown-item">Landscaping</a>
											</li>
											<li>
												<a href="/search?category=junk removal" class="dropdown-item">Junk
													Removal</a>
											</li>
											<li>
												<a href="/search?category=masonry services"
													class="dropdown-item">Masonry</a>
											</li>
											<li>
												<a href="/search?category=plumbing services"
													class="dropdown-item">Plumbing</a>
											</li>
											<li>
												<a href="/search?category=hvac services" class="dropdown-item">HVAC</a>
											</li>
											<li>
												<a href="/search?category=pest control" class="dropdown-item">Pest
													Control</a>
											</li>
											<li>
												<a href="/search?category=painting services"
													class="dropdown-item">Painting</a>
											</li>
										</ul>
										<ul class="dropdown_column">
											<li>
												<a href="/search?category=flooring services"
													class="dropdown-item">Flooring</a>
											</li>
											<li>
												<a href="/search?category=electrical services"
													class="dropdown-item">Electrical</a>
											</li>
											<li>
												<a href="/search?category=moving services"
													class="dropdown-item">Moving</a>
											</li>
											<li>
												<a href="/search?category=appliance services"
													class="dropdown-item">Appliance</a>
											</li>
											<li>
												<a href="/search?category=locksmith services"
													class="dropdown-item">Locksmith</a>
											</li>
										</ul>
									</div>
								</li>
								<li class="nav-item dropdown">
									<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Vehicle
										Services</a>
									<div class="dropdown-menu">
										<ul class="dropdown_column">
											<li>
												<a href="/search?category=towing services"
													class="dropdown-item">Towing</a>
											</li>
											<li>
												<a href="/search?category=vehicle repair" class="dropdown-item">Vehicle
													Repair</a>
											</li>
										</ul>
									</div>
								</li>
							</ul>
							<ul class="navbar-nav access_menu">
								<li class="nav-item cp_search_btn cp_search_btn_desktop dropdown">
									<a href="javascript:void(0)" data-target="#companySearchBar" data-toggle="dropdown"
										class="nav-link"><img src="../images/layout/search_icon_white.png"
											class="img-fluid" alt="" /></a>
									<div class="dropdown-menu company_search_down" aria-labelledby="companySearchBar">
										<form action="">
											<div class="company_search_field">
												<input id="myInput" type="search" placeholder="Search..."
													class="form-control" />
												<button class="btn" type="submit">
													<img src="../images/layout/search_icon_black.png" class="black_icon"
														alt="" />
													<img src="../images/layout/search_icon_white.png" class="white_icon"
														alt="" />
												</button>
											</div>
										</form>
									</div>
								</li>
								<% if(currentUser) { %>
									<li class="nav-item desktop_only_link">
										<a href="/inbox/<%= lastMessage?.messages?.receiver.id %>"
											class="nav-link">Messages</a>
									</li>
									<% if(currentUser && !currentUser.isCompany) { %>
										<li class="nav-item desktop_only_link">
											<a href="/saved-list" class="nav-link">Saved List</a>
										</li>
										<% } %>
											<li class="nav-item profile_pic_desktop">
												<a href="javascript:void(0)"
													class="nav-link profile_pic_link membersProfilePic">
													<div class="profile_pic">
														<% if (currentUser?.isCompany) { %>
															<% if(currentUser.logo) { %>
																<img src="<%= currentUser.logo %>" class="img-fluid"
																	alt="" />
																<% } else {%>
																	<img src="../images/man.png" class="img-fluid"
																		alt="" />
																	<% }%>
																		<% } else { %>
																			<% if(currentUser.profilePicture) {%>
																				<img src="<%= currentUser.profilePicture %>"
																					class="img-fluid"
																					alt="<%= currentUser.username %>" />
																				<%} else {%>
																					<img src="../images/man.png"
																						class="img-fluid"
																						alt="<%= currentUser.username %>" />
																					<% }%>
																						<% } %>
																							<span
																								class="activity_status online_status"></span>
													</div>
												</a>
											</li>
											<% } else {%>
												<li class="nav-item">
													<a href="/login" class="nav-link sign_in">Sign In</a>
												</li>
												<li class="nav-item">
													<a href="/sign-up" class="nav-link gbtn gbtn_white_bdr">Sign Up</a>
												</li>
												<li class="nav-item">
													<a href="/become-a-seller-overview" class="nav-link gbtn">Become a
														Seller</a>
												</li>
												<% } %>
							</ul>
						</div>
					</div>
				</div>
			</nav>
		</header>
		<!--===== Markup For "Header" Ends Here =====-->
		<% if(currentUser) { %>
			<!--===== Markup For "Members Profile Link" Starts From Here =====-->
			<div class="membersProfileLinks">
				<div class="dismissMembersProfileLinks">
					<i class="fa fa-times"></i>
				</div>
				<div class="members_profile_pic">
					<% if (currentUser?.isCompany) { %>
						<% if(currentUser.logo) { %>
							<a href="javascript:void(0)"><img src="<%= currentUser.logo %>" class="img-fluid"
									alt="<%= currentUser.username %>" /></a>
							<% } else {%>
								<a href="javascript:void(0)"><img src="../images/man.png" class="img-fluid"
										alt="profile Picture" /></a>
								<% }%>
									<h6>
										<%= currentUser.companyName %>
									</h6>
									<% } else { %>
										<% if(currentUser?.profilePicture) {%>
											<a href="javascript:void(0)"><img src="<%= currentUser.profilePicture %>"
													class="img-fluid" alt="<%= currentUser.username %>" /></a>
											<%} else {%>
												<a href="javascript:void(0)"><img src="../images/man.png"
														class="img-fluid" alt="profile picture" /></a>
												<% }%>
													<h6>
														<%= currentUser.firstName + " " + currentUser.lastName %>
													</h6>
													<% } %>
				</div>
				<div class="profile_links">
					<% if (currentUser.isCompany) { %>
						<ul>
							<li>
								<i class="fas fa-user"></i>
								<a href="/company-dashboard">View Dashboard</a>
							</li>
							<li class="mobile_only">
								<i class="fas fa-envelope"></i>
								<a href="/inbox/<%= lastMessage?.messages?.receiver.id %>">Messages</a>
							</li>
							<li><i class="fas fa-shopping-cart"></i><a href="/manage-orders">Manage Orders</a></li>
							<li>
								<i class="fas fa-cog"></i>
								<a href="/company-settings/account">Settings</a>
							</li>
							<li><i class="fas fa-power-off"></i> <a href="/logout">Logout</a></li>
						</ul>
						<% } else { %>
							<ul>
								<li>
									<i class="fas fa-user"></i>
									<a href="/member-profile/<%= currentUser._id %>">View Profile</a>
								</li>
								<li class="mobile_only">
									<i class="fas fa-envelope"></i>
									<a href="/inbox/<%= lastMessage?.messages?.receiver.id %>">Messages</a>
								</li>
								<% if(currentUser && !currentUser.isCompany) { %>
									<li class="mobile_only">
										<i class="fas fa-list-alt"></i> <a href="/saved-list">Saved List</a>
									</li>
									<% } %>
									<li><i class="fas fa-shopping-cart"></i><a href="/manage-orders">Manage Orders</a></li>
										<li>
											<i class="fas fa-cog"></i>
											<a href="/company-settings/account">Settings</a>
										</li>
										<li><i class="fas fa-power-off"></i> <a href="/logout">Logout</a></li>
							</ul>
							<% } %>
				</div>
			</div>
			<!--===== Markup For "Members Profile Link" Ends Here =====-->
			<% } %>
				<section class="gb_chat_wrap">
					<div class="gb_top_search_wrap">
						<div class="back_to_list">
							<a class="mobile_chat_layout_cancel" href="javascript:void(0)"><img
									src="../images/left_arrow_icon_blue.png" class="img-fluid" alt="" /></a>
						</div>
						<div class="gb_top_search">
							<div class="client_search">
								<input type="search" placeholder="Search client name..." class="form-control"
									id="contactSearch">
								<button class="btn">
									<img src="../images/search_icon3_black.png" class="img-fluid black_icon" alt="" />
									<img src="../images/search_icon3_blue.png" class="img-fluid blue_icon" alt="" />
								</button>
							</div>
						</div>
						<div class="other_actions" style="display: flex; justify-content: flex-end">
							<a class="showChatBox" href="javascript:void(0)" title="Open Chat" data-toggle="tooltip">
								<img id="openMobileView" src="../images/layout/right_arrow_icon_blue.png" width="40px"
									height="40px" class="img-fluid" alt="" />
							</a>
						</div>
					</div>
					<div class="gb_chat">
						<div class="gb_list">
							<section id="contactListLabelTabs">
								<div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
									<a class="nav-item nav-link active" id="allConversations_tab" data-toggle="tab"
										href="#allConversations" role="tab" aria-controls="allConversations"
										aria-selected="true">All Conversations</a>
									<a class="nav-item nav-link" id="labeled_tab" data-toggle="tab" href="#labeled"
										role="tab" aria-controls="labeled" aria-selected="false">Labled</a>
								</div>
								<div class="tab-content" id="nav-tabContent">
									<div class="tab-pane fade show active" id="allConversations" role="tabpanel"
										aria-labelledby="allConversations_tab">
										<!--===== Markup For "Contact List" Starts From Here =====-->
										<div class="contact_list">
											<ul id="searchFilter">
												<% if(chat !==undefined && chat.length) { %>
													<% chat.forEach(function(conv, i) { %>
														<% if(conv[conv.length -
															1].messages.sender.id?._id.toString()===user?._id.toString()
															) {%>
															<li
																id="<%=conv[conv.length-1].messages.receiver.id?.username %>">
																<% if(conv[conv.length-1].messages.receiver.id?._id.toString()===otherUser._id.toString())
																	{%>
																	<a class="addactive"
																		href="/inbox/<%= conv[conv.length-1].messages.receiver.id._id %>">
																		<%} else {%>
																			<a
																				href="/inbox/<%= conv[conv.length-1].messages.receiver.id?._id %>">
																				<% }%>
																					<div class="profile_pic">
																						<%if(conv[conv.length-1].messages.receiver.id?.isCompany)
																							{ %>
																							<%if(conv[conv.length-1].messages.receiver.id?.logo){
																								%>
																								<img src="<%=conv[conv.length-1].messages.receiver.id?.logo %>"
																									alt="" />
																								<%} else {%>
																									<img src="../images/man.png"
																										alt="" />
																									<% }%>
																										<%} else {%>
																											<%if(conv[conv.length-1].messages.receiver.id.profilePicture){
																												%>
																												<img src="<%=conv[conv.length-1].messages.receiver.id?.profilePicture %>"
																													alt="" />
																												<%} else
																													{%>
																													<img src="../images/man.png"
																														alt="" />
																													<% } }
																														%>
																														<% if
																															(conv[conv.length
																															-
																															1].messages.receiver.id?.status)
																															{
																															%>
																															<span
																																class="activity_status online_status"></span>
																															<% } else
																																{
																																%>
																																<span
																																	class="activity_status offline_status"></span>
																																<% }
																																	%>
																					</div>
																					<div id="<%= conv[conv.length-1].messages.receiver.id._id %>"
																						class="profile_info">
																						<div class="user_name"
																							style="text-transform: capitalize;">
																							<%if(conv[conv.length-1].messages.receiver.id.isCompany)
																								{ %>
																								<h6
																									style="text-transform: capitalize;">
																									<%= conv[conv.length-1].messages.receiver.id?.companyName
																										%>
																								</h6>
																								<%} else {%>
																									<h6
																										style="text-transform: capitalize;">
																										<%= conv[conv.length-1].messages.receiver.id?.firstName
																											+ ' ' +
																											conv[conv.length-1].messages.receiver.id?.lastName
																											%>
																									</h6>
																									<% } %>
																						</div>
																						<p> <span> Me:</span>
																							<%= conv[conv.length -
																								1].messages.text %>
																								<span
																									class="badge badge-info"
																									style="display: none;">New</span>
																						</p>
																						<time>
																							<% if (conv[conv.length -
																								1].messages.receiver.id?.status)
																								{ %>
																								<span>Online</span>
																								<% } else { %>
																									<%= timeAgo[i] %>
																										<% } %>
																						</time>
																					</div>
																			</a>
															</li>
															<%} else if (conv[conv.length -
																1].messages.receiver.id?._id.toString()===user?._id.toString()){
																%>
																<li
																	id="<%=conv[conv.length-1].messages.sender.id?.username %>">
																	<% if(conv[conv.length-1].messages.sender.id?._id.toString()===otherUser?._id.toString())
																		{%>
																		<a
																			href="/inbox/<%= conv[conv.length-1].messages.sender.id?._id %>">
																			<%} else {%>
																				<a
																					href="/inbox/<%= conv[conv.length-1].messages.sender.id?._id %>">
																					<% }%>
																						<div class="profile_pic">
																							<%if(conv[conv.length-1].messages.sender.id?.isCompany)
																								{ %>
																								<%if(conv[conv.length-1].messages.sender.id.logo){
																									%>
																									<img src="<%=conv[conv.length-1].messages.sender.id?.logo %>"
																										alt="" />
																									<%} else {%>
																										<img src="../images/man.png"
																											alt="" />
																										<% }%>
																											<%} else {%>
																												<%if(conv[conv.length-1].messages.sender.id?.profilePicture){
																													%>
																													<img src="<%=conv[conv.length-1].messages.sender.id?.profilePicture %>"
																														alt="" />
																													<%} else
																														{%>
																														<img src="../images/man.png"
																															alt="" />
																														<% } }
																															%>
																															<% if
																																(conv[conv.length
																																-
																																1].messages.sender.id?.status)
																																{
																																%>
																																<span
																																	class="activity_status online_status"></span>
																																<% } else
																																	{
																																	%>
																																	<span
																																		class="activity_status offline_status"></span>
																																	<% }
																																		%>
																						</div>
																						<div id="<%= conv[conv.length-1].messages.sender.id?._id %>"
																							class="profile_info">
																							<div class="user_name"
																								style="text-transform: capitalize;">
																								<%if(conv[conv.length-1].messages.sender.id?.isCompany)
																									{ %>
																									<h6>
																										<%= conv[conv.length-1].messages.sender.id?.companyName
																											%>
																									</h6>
																									<%} else {%>
																										<h6>
																											<%= conv[conv.length-1].messages.sender.id?.firstName
																												+ ' ' +
																												conv[conv.length-1].messages.sender.id?.lastName
																												%>
																										</h6>
																										<% } %>
																							</div>
																							<p>
																								<%= conv[conv.length -
																									1].messages.text %>
																									<span
																										class="badge badge-info"
																										style="display: none;">New</span>
																							</p>
																							<time>
																								<% if (conv[conv.length
																									-
																									1].messages.sender.id?.status)
																									{ %>
																									<span>Online</span>
																									<% } else { %>
																										<%= timeAgo[i]
																											%>
																											<% } %>
																							</time>
																						</div>
																				</a>
																</li>
																<% } %>
																	<% }) %>
																		<% } %>
											</ul>
										</div>
										<!--===== Markup For "Contact List" Ends Here =====-->
									</div>
									<div class="tab-pane fade" id="labeled" role="tabpanel"
										aria-labelledby="labeled_tab">
										<!--===== Markup For "Contact List" Starts From Here =====-->
										<div class="contact_list">
											<ul>
												<% if(chat !==undefined && chat.length) { %>
													<% chat.forEach(function(conv, i) { %>
														<% if(conv[conv.length -
															1].messages.sender.id?._id.toString()===user?._id.toString()
															) {%>
															<% labels.forEach(function(label, i) { %>
																<% if(label.members.includes(conv[conv.length-1].messages.receiver.id?._id.toString()))
																	{ %>
																	<li
																		id="<%=conv[conv.length-1].messages.receiver.id?.username %>">
																		<% if(conv[conv.length-1].messages.receiver.id?._id.toString()===otherUser._id.toString())
																			{%>
																			<a class="addactive"
																				href="/inbox/<%= conv[conv.length-1].messages.receiver.id._id %>">
																				<div class="profile_pic">
																					<%if(conv[conv.length-1].messages.receiver.id?.isCompany)
																						{ %>
																						<%if(conv[conv.length-1].messages.receiver.id?.logo){
																							%>
																							<img src="<%=conv[conv.length-1].messages.receiver.id?.logo %>"
																								alt="" />
																							<%} else {%>
																								<img src="../images/man.png"
																									alt="" />
																								<% }%>
																									<%} else {%>
																										<%if(conv[conv.length-1].messages.receiver.id.profilePicture){
																											%>
																											<img src="<%=conv[conv.length-1].messages.receiver.id?.profilePicture %>"
																												alt="" />
																											<%} else {%>
																												<img src="../images/man.png"
																													alt="" />
																												<% } }
																													%>
																				</div>
																				<div class="profile_info">
																					<div class="user_name">
																						<%if(conv[conv.length-1].messages.receiver.id.isCompany)
																							{ %>
																							<h6
																								style="text-transform: capitalize;">
																								<%= conv[conv.length-1].messages.receiver.id?.companyName
																									%>
																							</h6>
																							<%} else {%>
																								<h6
																									style="text-transform: capitalize;">
																									<%= conv[conv.length-1].messages.receiver.id?.firstName
																										+ ' ' +
																										conv[conv.length-1].messages.receiver.id?.lastName
																										%>
																								</h6>
																								<% } %>
																					</div>
																					<p>
																						<%= conv[conv.length -
																							1].messages.text %>
																					</p>
																					<time>
																						<% if (conv[conv.length -
																							1].messages.receiver.id?.status)
																							{ %>
																							<span>Active Now</span>
																							<% } else { %>
																								<%= timeAgo[i] %>
																									<% } %>
																					</time>
																					<div class="label_wrap">
																						<span>
																							<%= label.title %>
																						</span>
																					</div>
																				</div>
																			</a>
																			<%} else {%>
																				<a
																					href="/inbox/<%= conv[conv.length-1].messages.receiver.id?._id %>">
																					<div class="profile_pic">
																						<%if(conv[conv.length-1].messages.receiver.id?.isCompany)
																							{ %>
																							<%if(conv[conv.length-1].messages.receiver.id?.logo){
																								%>
																								<img src="<%=conv[conv.length-1].messages.receiver.id?.logo %>"
																									alt="" />
																								<%} else {%>
																									<img src="../images/man.png"
																										alt="" />
																									<% }%>
																										<%} else {%>
																											<%if(conv[conv.length-1].messages.receiver.id.profilePicture){
																												%>
																												<img src="<%=conv[conv.length-1].messages.receiver.id?.profilePicture %>"
																													alt="" />
																												<%} else
																													{%>
																													<img src="../images/man.png"
																														alt="" />
																													<% } }
																														%>
																					</div>
																					<div class="profile_info">
																						<div class="user_name"
																							style="text-transform: capitalize;">
																							<%if(conv[conv.length-1].messages.receiver.id.isCompany)
																								{ %>
																								<h6
																									style="text-transform: capitalize;">
																									<%= conv[conv.length-1].messages.receiver.id?.companyName
																										%>
																								</h6>
																								<%} else {%>
																									<h6
																										style="text-transform: capitalize;">
																										<%= conv[conv.length-1].messages.receiver.id?.firstName
																											+ ' ' +
																											conv[conv.length-1].messages.receiver.id?.lastName
																											%>
																									</h6>
																									<% } %>
																						</div>
																						<p>
																							<%= conv[conv.length -
																								1].messages.text %>
																						</p>
																						<time>
																							<% if (conv[conv.length -
																								1].messages.receiver.id?.status)
																								{ %>
																								<span>Active Now</span>
																								<% } else { %>
																									<%= timeAgo[i] %>
																										<% } %>
																						</time>
																						<div class="label_wrap">
																							<span>
																								<%= label.title %>
																							</span>
																						</div>
																					</div>
																				</a>
																				<% }%>
																	</li>
																	<% } %>
																		<% }) %>
																			<%} else if (conv[conv.length -
																				1].messages.receiver.id?._id.toString()===user?._id.toString()){
																				%>
																				<% labels.forEach(function(label, i) {
																					%>
																					<% if(label.members.includes(conv[conv.length-1].messages.sender.id?._id.toString()))
																						{ %>
																						<li
																							id="<%=conv[conv.length-1].messages.sender.id?.username %>">
																							<% if(conv[conv.length-1].messages.sender.id?._id.toString()===otherUser?._id.toString())
																								{%>
																								<a
																									href="/inbox/<%= conv[conv.length-1].messages.sender.id?._id %>">
																									<div
																										class="profile_pic">
																										<%if(conv[conv.length-1].messages.sender.id?.isCompany)
																											{ %>
																											<%if(conv[conv.length-1].messages.sender.id.logo){
																												%>
																												<img src="<%=conv[conv.length-1].messages.sender.id?.logo %>"
																													alt="" />
																												<%} else
																													{%>
																													<img src="../images/man.png"
																														alt="" />
																													<%
																														}%>
																														<%} else
																															{%>
																															<%if(conv[conv.length-1].messages.sender.id?.profilePicture){
																																%>
																																<img src="<%=conv[conv.length-1].messages.sender.id?.profilePicture %>"
																																	alt="" />
																																<%} else
																																	{%>
																																	<img src="../images/man.png"
																																		alt="" />
																																	<% } }
																																		%>
																																		<% if
																																			(conv[conv.length
																																			-
																																			1].messages.sender.id?.status)
																																			{
																																			%>
																																			<span
																																				class="activity_status online_status"></span>
																																			<% } else
																																				{
																																				%>
																																				<span
																																					class="activity_status offline_status"></span>
																																				<% }
																																					%>
																									</div>
																									<div
																										class="profile_info">
																										<div class="user_name"
																											style="text-transform: capitalize;">
																											<%if(conv[conv.length-1].messages.sender.id?.isCompany)
																												{ %>
																												<h6>
																													<%= conv[conv.length-1].messages.sender.id?.companyName
																														%>
																												</h6>
																												<%} else
																													{%>
																													<h6>
																														<%= conv[conv.length-1].messages.sender.id?.firstName
																															+ ' '
																															+
																															conv[conv.length-1].messages.sender.id?.lastName
																															%>
																													</h6>
																													<% }
																														%>
																										</div>
																										<p>
																											<%= conv[conv.length
																												-
																												1].messages.text
																												%>
																										</p>
																										<time>
																											<% if
																												(conv[conv.length
																												-
																												1].messages.sender.id?.status)
																												{ %>
																												<span>Active
																													Now</span>
																												<% } else
																													{ %>
																													<%= timeAgo[i]
																														%>
																														<% }
																															%>
																										</time>
																										<div
																											class="label_wrap">
																											<span>
																												<%= label.title
																													%>
																											</span>
																										</div>
																									</div>
																								</a>
																								<%} else {%>
																									<a
																										href="/inbox/<%= conv[conv.length-1].messages.sender.id?._id %>">
																										<div
																											class="profile_pic">
																											<%if(conv[conv.length-1].messages.sender.id?.isCompany)
																												{ %>
																												<%if(conv[conv.length-1].messages.sender.id.logo){
																													%>
																													<img src="<%=conv[conv.length-1].messages.sender.id?.logo %>"
																														alt="" />
																													<%} else
																														{%>
																														<img src="../images/man.png"
																															alt="" />
																														<%
																															}%>
																															<%} else
																																{%>
																																<%if(conv[conv.length-1].messages.sender.id?.profilePicture){
																																	%>
																																	<img src="<%=conv[conv.length-1].messages.sender.id?.profilePicture %>"
																																		alt="" />
																																	<%} else
																																		{%>
																																		<img src="../images/man.png"
																																			alt="" />
																																		<% } }
																																			%>
																																			<% if
																																				(conv[conv.length
																																				-
																																				1].messages.sender.id?.status)
																																				{
																																				%>
																																				<span
																																					class="activity_status online_status"></span>
																																				<% } else
																																					{
																																					%>
																																					<span
																																						class="activity_status offline_status"></span>
																																					<% }
																																						%>
																										</div>
																										<div
																											class="profile_info">
																											<div class="user_name"
																												style="text-transform: capitalize;">
																												<%if(conv[conv.length-1].messages.sender.id?.isCompany)
																													{ %>
																													<h6>
																														<%= conv[conv.length-1].messages.sender.id?.companyName
																															%>
																													</h6>
																													<%} else
																														{%>
																														<h6>
																															<%= conv[conv.length-1].messages.sender.id?.firstName
																																+ ' '
																																+
																																conv[conv.length-1].messages.sender.id?.lastName
																																%>
																														</h6>
																														<% }
																															%>
																											</div>
																											<p>
																												<%= conv[conv.length
																													-
																													1].messages.text
																													%>
																											</p>
																											<time>
																												<% if
																													(conv[conv.length
																													-
																													1].messages.sender.id?.status)
																													{ %>
																													<span>Active
																														Now</span>
																													<% } else
																														{
																														%>
																														<%= timeAgo[i]
																															%>
																															<% }
																																%>
																											</time>
																											<div
																												class="label_wrap">
																												<span>
																													<%= label.title
																														%>
																												</span>
																											</div>
																										</div>
																									</a>
																									<% }%>
																						</li>
																						<% } %>
																							<% }) %>
																								<% } %>
																									<% }) %>
																										<% } %>
											</ul>
										</div>
										<!--===== Markup For "Contact List" Ends Here =====-->
									</div>
								</div>
							</section>
						</div>
						<div class="gb_messages">
							<!--===== Markup For "Message Header" Starts From Here =====-->
							<div class="message_header">
								<div class="history_search">
									<div class="msg_header_history grid_item">
										<div class="history_wrap">
											<a href="javascript:void(0)" data-target="#theOrderHistory"
												data-toggle="modal">
												<img title="Past Orders" data-toggle="tooltip"
													src="../images/history_icon_black.png" class="img-fluid black_icon"
													alt="" />
												<img title="Past Orders" data-toggle="tooltip"
													src="../images/history_icon_blue.png" class="img-fluid blue_icon"
													alt="" />
											</a>
										</div>
									</div>
									<div class="msg_header_search">
										<form class="search_form" role="search">
											<div class="sliding_search_wrap">
												<input type="text" id="searchMessage" class="form-control"
													placeholder="Search">
												<button type="submit" class="search_submit">
													<img src="../images/search_icon_2_black.png"
														class="img-fluid black_icon" alt="" />
													<img src="../images/search_icon_2_blue.png"
														class="img-fluid blue_icon" alt="" />
												</button>
												<div class="search_label" title="Message Search" data-toggle="tooltip">
													<img src="../images/search_icon_2_black.png"
														class="img-fluid black_icon" alt="" />
													<img src="../images/search_icon_2_blue.png"
														class="img-fluid blue_icon" alt="" />
												</div>
											</div>
											<div class="search_results_wrap" style="display: none;">
												<div class="search_results">
													<% var countoth=0 %>
														<% messages?.forEach(function(message){ %>
															<% countoth++ %>
																<div class="single_result">
																	<a href="javascript:void(0)">
																		<% if(message.messages.sender.id.isCompany){ %>
																			<% if(message.messages.sender.id.logo){ %>
																				<div class="profile_pic">
																					<img src="<%= message.messages.sender.id.logo %>"
																						alt="">
																				</div>
																				<% } else {%>
																					<div class="profile_pic">
																						<img src="../images/man.png"
																							alt="">
																					</div>
																					<% } %>
																						<% } else { %>
																							<% if(message.messages.sender.id.profilePicture){
																								%>
																								<div
																									class="profile_pic">
																									<img src="<%= message.messages.sender.id.profilePicture %>"
																										alt="">
																								</div>
																								<% } else {%>
																									<div
																										class="profile_pic">
																										<img src="../images/man.png"
																											alt="">
																									</div>
																									<% } %>
																										<% } %>
																											<div
																												class="profile_info">
																												<% if(message.messages.sender.id.isCompany){
																													%>
																													<div
																														class="user_name">
																														<h6
																															style="text-transform: capitalize;">
																															<%= message.messages.sender.id.companyName
																																%>
																														</h6>
																													</div>
																													<% } else
																														{
																														%>
																														<div
																															class="user_name">
																															<h6
																																style="text-transform: capitalize;">
																																<%= message.messages.sender.id.firstName
																																	+ ' '
																																	+
																																	message.messages.sender.id.lastName%>
																															</h6>
																														</div>
																														<% }
																															%>
																															<p>
																																<%= message.messages.text
																																	%>
																															</p>
																															<time>
																																<%= message.timeAgo
																																	%>
																															</time>
																											</div>
																	</a>
																</div>
																<% }) %>
												</div>
											</div>
										</form>
									</div>
								</div>
								<div class="call_actions grid_item">
									<ul>
										<li>
											<a href="javascript:void(0)" title="Call Directly" data-toggle="tooltip">
												<img src="../images/voice_call_icon_black.png"
													class="img-fluid black_icon" alt="" />
												<img src="../images/voice_call_icon_blue.png"
													class="img-fluid blue_icon" alt="" />
											</a>
										</li>
										<li>
											<a href="javascript:void(0)" title="Video Call" data-toggle="tooltip">
												<img src="../images/video_call_icon_black.png"
													class="img-fluid black_icon" alt="" />
												<img src="../images/video_call_icon_blue.png"
													class="img-fluid blue_icon" alt="" />
											</a>
										</li>
										<li class="dropdown dotted_dropdown">
											<a class="dotted_link" href="javascript:void(0)"
												data-target="#userActionsDown" data-toggle="dropdown">
												<img src="../images/three_dots_black.png" class="img-fluid black_icon"
													alt="" />
												<img src="../images/three_dots_blue.png" class="img-fluid blue_icon"
													alt="" />
											</a>
											<div class="dropdown-menu user_actions_down"
												aria-labelledby="userActionsDown">
												<div class="user_actions">
													<ul>
														<li class="view_activity">
															<a class="view_activity_link" href="javascript:void(0)">
																<img src="../images/activity_icon_black.png"
																	class="img-fluid black_icon" alt="" />
																<img src="../images/activity_icon_blue.png"
																	class="img-fluid blue_icon" alt="" />
																View Activity
															</a>
														</li>
														<% if(otherUser?.isCompany) {%>
															<li>
																<a href="../company-profile/<%= otherUser?.id %> ">
																	<img src="../images/user_icon_black.png"
																		class="img-fluid black_icon" alt="" />
																	<img src="../images/user_icon_blue.png"
																		class="img-fluid blue_icon" alt="" />
																	View Profile
																</a>
															</li>
															<% } else { %>
																<li>
																	<a href="../member-profile/<%= otherUser?.id %> ">
																		<img src="../images/user_icon_black.png"
																			class="img-fluid black_icon" alt="" />
																		<img src="../images/user_icon_blue.png"
																			class="img-fluid blue_icon" alt="" />
																		View Profile
																	</a>
																</li>
																<% } %>
																	<li>
																		<a href="javascript:void(0)">
																			<img src="../images/label_icon_black.png"
																				class="img-fluid black_icon" alt="" />
																			<img src="../images/label_icon_blue.png"
																				class="img-fluid blue_icon" alt="" />
																			Label
																		</a>
																		<ul class="sublist">
																			<li><a href="javascript:void(0)"
																					data-target="#addLabel"
																					data-toggle="modal">Add new
																					Label</a></li>
																			<% labels.forEach(function(label){ %>
																				<form
																					id="<%= receiverID %>/<%= label._id %>"
																					action="/save-to-label/<%= receiverID%>/<%= label._id %>"
																					method="POST">
																					<li><a href="#"
																							onclick="document.getElementById('<%= receiverID %>/<%= label._id %>').submit();">
																							<%= label.title %>
																						</a></li>
																				</form>
																				<% }); %>
																		</ul>
																	</li>
																	<!-- <li>
													<a href="javascript:void(0)">
														<img src="../images/pin_icon2_black.png" class="img-fluid black_icon" alt="" />
														<img src="../images/pin_icon2_blue.png" class="img-fluid blue_icon" alt="" />
														Pinned Message
													</a>
												</li>
												<li>
													<a href="javascript:void(0)">
														<img src="../images/report_icon_black.png" class="img-fluid black_icon" alt="" />
														<img src="../images/report_icon_blue.png" class="img-fluid blue_icon" alt="" />
														Report Member
													</a>
												</li> -->
																	<li>
																		<a href="javascript:void(0)">
																			<img src="../images/trash_icon_black.png"
																				class="img-fluid black_icon" alt="" />
																			<img src="../images/trash_icon_blue.png"
																				class="img-fluid blue_icon" alt="" />
																			Delete
																		</a>
																	</li>
													</ul>
												</div>
											</div>
										</li>
									</ul>
								</div>
							</div>
							<!--===== Markup For "Message Header" Ends Here =====-->
							<div class="gb_msgs">
								<!--===== Markup For "Sent & Received SMS" Starts From Here =====-->
								<div class="msg_flow">
									<div class="all_msgs" id="chat-message">
										<div class="security_alert_msg">
											<h5><img src="../images/shield_icon_blue.png" class="img-fluid" alt="" />
												Security</h5>
											<p>For the safety and your protection, keep payments and communications
												within a gabazzo <a href="javascript:void(0)">Learn more</a></p>
										</div>
										<% var countmsg=1 %>
											<% messages?.forEach(function(message){ %>
												<% if (message.messages.sender.id._id==currentUser?.id){ %>
													<div class="msg_wrap sent_msg_wrap">
														<%if(message.messages.sender.id.isCompany) {%>
															<div class="profile_link_image">
																<%if(message.messages.sender.id.logo){ %>
																	<a href="javascript:void(0)"><img
																			src="<%=message.messages.sender.id.logo %>"
																			alt="" /></a>
																	<%} else { %>
																		<a href="javascript:void(0)"><img
																				src="../images/man.png" alt="" /></a>
																		<% }%>
															</div>
															<% } else { %>
																<div class="profile_link_image">
																	<%if(message.messages.sender.id.profilePicture){ %>
																		<a href="javascript:void(0)"><img
																				src="<%=message.messages.sender.id.profilePicture %>"
																				alt="" /></a>
																		<%} else { %>
																			<a href="javascript:void(0)"><img
																					src="../images/man.png"
																					alt="" /></a>
																			<% } %>
																</div>
																<% } %>
																	<div class="msg_content">
																		<% if(message.offerID) {%>
																			<div class="sent_offer">
																				<div class="indicator_texts">
																					<h4>
																						<%= message.messages.text %><a
																								href="javascript:void(0)"
																								title="<%=  message.offerID.service?.title %>"
																								data-toggle="tooltip"
																								data-placement="left"><i
																									class="fas fa-info-circle"></i></a>
																							<time>| <%=
																									message.timeAgo%>
																							</time>
																					</h4>
																				</div>
																				<div class="offer_box_wrap">
																					<div class="payment_type">
																						<% if
																							(message.offerID.type==='singlepayment'
																							) { %>
																							<h4>Single Payment Offer
																							</h4>
																							<% } else { %>
																								<h4>Milestone Payment
																									Offer</h4>
																								<% } %>
																					</div>
																					<div class="all_milestones"
																						id="allMilestone">
																						<% for(let i=0; i<
																							message.offerID.tasks?.length;
																							i++) {%>
																							<div class="single_item">
																								<div class="click_item">
																									<a href="javascript:void(0)"
																										data-target="#mileTask<%= i + message.offerID._id %>"
																										class="collapsed"
																										data-toggle="collapse">
																										<div
																											class="milestone_name_price">
																											<div
																												class="milestone_name">
																												<% if(message.offerID.type==='singlepayment'
																													){
																													%>
																													<h4>Description
																														#
																														<%= i+1
																															%>
																													</h4>
																													<%} else
																														{%>
																														<h4>Milestone
																															#
																															<%= i+1
																																%>
																														</h4>
																														<%}%>
																											</div>
																											<div
																												class="milestone_price">
																												<h4>$<%= message.offerID.tasks[i].totalPrice
																														%>
																												</h4>
																											</div>
																										</div>
																									</a>
																								</div>
																								<div id="mileTask<%= i + message.offerID._id %>"
																									class="collapse fade contents"
																									data-parent="#allMilestone">
																									<div
																										class="sent_offer_box">
																										<div
																											class="title">
																											<h4>
																												<%= message.offerID.service?.title
																													%>
																											</h4>
																										</div>
																										<div
																											class="service_img_descrip">
																											<div
																												class="service_image">
																												<img src="<%= message.offerID.service?.images[0].url %>"
																													class="img-fluid"
																													alt="" />
																											</div>
																											<div
																												class="service_descrip">
																												<p>
																													<%= message.offerID.tasks[i]?.description
																														%>
																												</p>
																											</div>
																										</div>
																										<div
																											class="offer_facts milestone_facts">
																											<div
																												class="single_fact">
																												<h6>QTY
																												</h6>
																												<div
																													class="tiny_box tiny_box_usd">
																													<h5>
																														<%= message.offerID.tasks[i]?.quantity
																															%>
																													</h5>
																													<i
																														class="fas fa-sort-amount-up-alt"></i>
																												</div>
																											</div>
																											<% if
																												(message.offerID.type==='milestonepayment'
																												) { %>
																												<div
																													class="single_fact">
																													<h6>Delivery
																													</h6>
																													<div
																														class="tiny_box tiny_box_usd">
																														<h5>
																															<%= message.offerID.tasks[i].delivery
																																%>
																																Days
																														</h5>
																														<i
																															class="far fa-clock"></i>
																													</div>
																												</div>
																												<% } %>
																													<div
																														class="single_fact">
																														<h6>Unit
																															Price
																														</h6>
																														<div
																															class="tiny_box tiny_box_usd">
																															<h5>
																																<%= message.offerID.tasks[i].unitPrice
																																	%>
																															</h5>
																															<i
																																class="fas fa-dollar-sign"></i>
																														</div>
																													</div>
																													<div
																														class="single_fact">
																														<h6>Total
																														</h6>
																														<div
																															class="tiny_box tiny_box_usd">
																															<h5>
																																<%= message.offerID.tasks[i].totalPrice
																																	%>
																															</h5>
																															<i
																																class="fas fa-dollar-sign"></i>
																														</div>
																													</div>
																										</div>
																									</div>
																								</div>
																							</div>
																							<% }%>
																					</div>
																					<div class="offer_facts_buttons">
																						<div
																							class="offer_facts total_facts">
																							<div class="single_fact">
																								<h6>Sub Total</h6>
																								<div
																									class="tiny_box tiny_box_usd">
																									<h5>
																										<%= message.offerID.subTotal
																											%>
																									</h5>
																									<i
																										class="fas fa-dollar-sign"></i>
																								</div>
																							</div>
																							
																								<div class="single_fact">
																									<h6>Discount</h6>
																								<div class="tiny_box tiny_box_usd">
																								<h5></h5>
																								<i class="fas fa-dollar-sign"></i>
																									</div>
																								</div>
																							<div class="single_fact">
																								<h6>Delivery</h6>
																								<div
																									class="tiny_box tiny_box_usd">
																									<h5>
																										<%= message.offerID.totalDuration
																											%> Days
																									</h5>
																									<i
																										class="far fa-clock"></i>
																								</div>
																							</div>
																							<div class="single_fact">
																								<h6>Gabazzo Fee</h6>
																								<div class="tiny_box">
																									<h5>5%</h5>
																								</div>
																							</div>
																							
																							<div class="single_fact">
																								<h6>Tax</h6>
																								<div class="tiny_box">
																								<h5>%</h5>
																								</div>
																							</div>
																							
																							<div class="single_fact">
																								<h6>Revisions</h6>
																								<div
																									class="tiny_box tiny_box_usd">
																									<h5>
																										<%= message.offerID.revision
																											%>
																									</h5>
																									<i
																										class="fas fa-sync-alt"></i>
																								</div>
																							</div>
																							<div class="single_fact">
																								<h6>Quote Total</h6>
																								<div
																									class="tiny_box tiny_box_usd">
																									<h5>
																										<%= message.offerID.totalCost
																											%>
																									</h5>
																									<i
																										class="fas fa-dollar-sign"></i>
																								</div>
																							</div>
																						</div>
																						<%
																							if(message.messages.sender.id._id.toString()===user._id.toString()){%>
																							<div class="offer_buttons">
																								<div
																									class="left_buttons">
																									<ul>
																										<li><a href="https://s3.amazonaws.com/assets.gabazzo.com/<%= message.offerID._id %>.pdf"
																												target="_blank"
																												class="gbtn gbtn_orange_bdr">View
																												PDF
																												File</a>
																										</li>
																									</ul>
																								</div>
																								<div
																									class="right_buttons">
																									<ul>
																										<% if(message.offerID.status==='withdrawn'
																											) { %>
																											<ul>
																												<li> <b> Offer
																														Withdrawn
																													</b>
																												</li>
																											</ul>
																											<%} else
																												if(message.offerID.status==='accepted'
																												) {%>
																												<ul>
																													<li
																														style="font-family: fangsong; color:green">
																														<b> Offer
																															Accepted
																														</b>
																													</li>
																												</ul>
																												<%} else
																													if(message.offerID.status==='declined'
																													)
																													{%>
																													<ul>
																														<li
																															style="font-family: fangsong; color:red">
																															<b> Offer
																																Declined
																															</b>
																														</li>
																													</ul>
																													<%} else
																														{%>
																														<ul>
																															<li
																																id="wd<%= message.offerID._id %>">
																																<button
																																	id=<%=message.offerID._id
																																	%>
																																	class="btn
																																	gbtn
																																	gbtn_bdr
																																	btnWithdraw">Withdraw
																																	Offer</button>
																															</li>
																														</ul>
																														<%
																															}%>
																									</ul>
																								</div>
																							</div>
																							<% } else { %>
																								<div
																									class="right_buttons">
																									<ul>
																										<% if(message.offerID.status==='withdrawn'
																											) { %>
																											<ul>
																												<li> <b> Offer
																														Withdrawn
																													</b>
																												</li>
																											</ul>
																											<%} else
																												if(message.offerID.status==='accepted'
																												) {%>
																												<ul>
																													<li
																														style="font-family: fangsong; color:green">
																														<b> Offer
																															Accepted
																														</b>
																													</li>
																												</ul>
																												<%} else
																													if(message.offerID.status==='declined'
																													)
																													{%>
																													<ul>
																														<li
																															style="font-family: fangsong; color:red">
																															<b> Offer
																																Declined
																															</b>
																														</li>
																													</ul>
																													<%} else
																														{%>
																														<ul
																															id="repButtons<%= message.offerID._id %>">
																															<li><button
																																	id='decline<%= message.offerID._id %>'
																																	type="submit"
																																	class="btn gbtn gbtn_bdr btnDec">Decline
																																	Offer</button>
																															</li>
																															<li><button
																																	id='accept<%= message.offerID._id %>'
																																	type="submit"
																																	class="btn gbtn btnAcp">Accept
																																	Offer</button>
																															</li>
																														</ul>
																														<%
																															}%>
																									</ul>
																								</div>
																								<% } %>
																					</div>
																				</div>
																			</div>
																			<% } else { %>
																				<div class="msg_body">
																					<p>
																						<%= message.messages.text %>
																					</p>
																				</div>
																				<div class="msg_attachments_files"
																					style="bottom: 0">
																					<% if(message.messages.attachments
																						!=undefined) {%>
																						<% message.messages.attachments.forEach(function(file)
																							{%>
																							<% let fileAddr=file.url;
																								let
																								tempfn=fileAddr.split("/");
																								let fileName=file?.name;
																								fileAddr.replace("/raw/upload", "/files"
																								); %>
																								<% if(file.type==='jpg'
																									||
																									file.type==='jpeg'
																									|| file.type==='png'
																									|| file.type==='gif'
																									) {%>
																									<div class="msg_attachment_items"
																										align="right">
																										<a href="<%=file.url%>"
																											rel="noopener noreferrer"
																											target="_blank"
																											download><img
																												src="<%=file.url%>"
																												class="img-thumbnail"
																												loading="lazy"
																												width="400px" /></a>
																									</div>
																									<% } else if
																										(file.url.substr(file.url.length
																										- 3)==='doc' ||
																										file.url.substr(file.url.length
																										- 4)==='docx' ||
																										file.url.substr(file.url.length
																										- 3)==='odt' ||
																										file.url.substr(file.url.length
																										- 3)==='txt' )
																										{%>
																										<div class="msg_attachment_items"
																											align="right">
																											<a href="<%=fileAddr%>"
																												class="file-links doc-link"
																												target="_blank"
																												download>
																												<%=fileName%>
																											</a>
																										</div>
																										<% } else if
																											(file.url.substr(file.url.length
																											- 3)==='pdf'
																											) {%>
																											<div class="msg_attachment_items"
																												align="right">
																												<a href="<%=fileAddr%>"
																													class="file-links pdf-link"
																													target="_blank"
																													download>
																													<%=fileName%>
																												</a>
																											</div>
																											<% } else if
																												(file.url.substr(file.url.length
																												-
																												3)==='zip'
																												||
																												file.url.substr(file.url.length
																												-
																												3)==='rar'
																												) {%>
																												<div class="msg_attachment_items"
																													align="right">
																													<a href="<%=fileAddr%>"
																														class="file-links zip-link"
																														target="_blank"
																														download>
																														<%=fileName%>
																													</a>
																												</div>
																												<% } else
																													if(file.url.substr(file.url.length
																													-
																													3)==='mp4'
																													||
																													file.url.substr(file.url.length
																													-
																													3)==='ogg'
																													||
																													file.url.substr(file.url.length
																													-
																													3)==='webm'
																													||
																													file.url.substr(file.url.length
																													-
																													3)==='mkv'
																													||
																													file.url.substr(file.url.length
																													-
																													3)==='mov'
																													)
																													{%>
																													<div class="msg_attachment_items"
																														height="200px"
																														width="160px"
																														style="margin: 5px;"
																														align="right">
																														<video
																															width="50%"
																															height="100%"
																															controls>
																															<source
																																src="<%=file.url%>"
																																type="video/mp4">
																															<source
																																src="<%=file.url%>"
																																type="video/ogg">
																														</video>
																													</div>
																													<% } else
																														{%>
																														<div class="msg_attachment_items"
																															align="right">
																															<a href="<%=fileAddr%>"
																																class="file-links other-link"
																																target="_blank"
																																download>
																																<%=fileName%>
																															</a>
																														</div>
																														<% }
																															%>
																															<% });
																																}
																																%>
																				</div>
																				<div class="msg_time_actions">
																					<div class="msg_time">
																						<time>
																							<%= message.timeAgo%>
																						</time>
																					</div>
																				</div>
																				<% } %>
																	</div>
													</div>
													<% } else { %>
														<div class="msg_wrap received_msg_wrap">
															<%if(message.messages.sender.id.isCompany) {%>
																<div class="profile_link_image">
																	<%if(message.messages.sender.id.logo){ %>
																		<a href="javascript:void(0)"><img
																				src="<%=message.messages.sender.id.logo %>"
																				alt="" /></a>
																		<% } else { %>
																			<a href="javascript:void(0)"><img
																					src="../images/man.png"
																					alt="" /></a>
																			<% } %>
																</div>
																<% } else { %>
																	<div class="profile_link_image">
																		<%if(message.messages.sender.id.profilePicture){
																			%>
																			<a href="javascript:void(0)"><img
																					src="<%=message.messages.sender.id.profilePicture %>"
																					alt="" /></a>
																			<%} else { %>
																				<a href="javascript:void(0)"><img
																						src="../images/man.png"
																						alt="" /></a>
																				<% }%>
																	</div>
																	<% } %>
																		<div class="msg_content">
																			<div class="msg_body">
																				<% if(message.offerID) {%>
																					<div class="sent_offer">
																						<div class="indicator_texts">
																							<h4>
																								<%= message.messages.text
																									%><a href="javascript:void(0)"
																										title="<%=  message.offerID.service?.title %>"
																										data-toggle="tooltip"
																										data-placement="left"><i
																											class="fas fa-info-circle"></i></a>
																									<time>| <%=
																											message.timeAgo%>
																									</time>
																							</h4>
																						</div>
																						<div class="offer_box_wrap">
																							<div class="payment_type">
																								<% if
																									(message.offerID.type==='singlepayment'
																									) { %>
																									<h4>Single Payment
																										Offer</h4>
																									<% } else { %>
																										<h4>Milestone
																											Payment
																											Offer</h4>
																										<% } %>
																							</div>
																							<div class="all_milestones"
																								id="allMilestone">
																								<% for(let i=0; i<
																									message.offerID.tasks?.length;
																									i++) {%>
																									<div
																										class="single_item">
																										<div
																											class="click_item">
																											<a href="javascript:void(0)"
																												data-target="#mileTask<%= i + message.offerID._id %>"
																												class="collapsed"
																												data-toggle="collapse">
																												<div
																													class="milestone_name_price">
																													<div
																														class="milestone_name">
																														<% if(message.offerID.type==='singlepayment'
																															){
																															%>
																															<h4>Description
																																#
																																<%= i+1
																																	%>
																															</h4>
																															<%} else
																																{%>
																																<h4>Milestone
																																	#
																																	<%= i+1
																																		%>
																																</h4>
																																<%}%>
																													</div>
																													<div
																														class="milestone_price">
																														<h4>$
																															<%= message.offerID.tasks[i].totalPrice
																																%>
																														</h4>
																													</div>
																												</div>
																											</a>
																										</div>
																										<div id="mileTask<%= i + message.offerID._id %>"
																											class="collapse fade contents"
																											data-parent="#allMilestone">
																											<div
																												class="sent_offer_box">
																												<div
																													class="title">
																													<h4>
																														<%= message.offerID.service?.title
																															%>
																													</h4>
																												</div>
																												<div
																													class="service_img_descrip">
																													<div
																														class="service_image">
																														<img src="<%= message.offerID.service?.images[0].url %>"
																															class="img-fluid"
																															alt="" />
																													</div>
																													<div
																														class="service_descrip">
																														<p>
																															<%= message.offerID.tasks[i]?.description
																																%>
																														</p>
																													</div>
																												</div>
																												<div
																													class="offer_facts milestone_facts">
																													<div
																														class="single_fact">
																														<h6>QTY
																														</h6>
																														<div
																															class="tiny_box tiny_box_usd">
																															<h5>
																																<%= message.offerID.tasks[i]?.quantity
																																	%>
																															</h5>
																															<i
																																class="fas fa-sort-amount-up-alt"></i>
																														</div>
																													</div>
																													<% if
																														(message.offerID.type==='milestonepayment'
																														)
																														{
																														%>
																														<div
																															class="single_fact">
																															<h6>Delivery
																															</h6>
																															<div
																																class="tiny_box tiny_box_usd">
																																<h5>
																																	<%= message.offerID.tasks[i].delivery
																																		%>
																																		Days
																																</h5>
																																<i
																																	class="far fa-clock"></i>
																															</div>
																														</div>
																														<% }
																															%>
																															<div
																																class="single_fact">
																																<h6>Unit
																																	Price
																																</h6>
																																<div
																																	class="tiny_box tiny_box_usd">
																																	<h5>
																																		<%= message.offerID.tasks[i].unitPrice
																																			%>
																																	</h5>
																																	<i
																																		class="fas fa-dollar-sign"></i>
																																</div>
																															</div>
																															<div
																																class="single_fact">
																																<h6>Total
																																</h6>
																																<div
																																	class="tiny_box tiny_box_usd">
																																	<h5>
																																		<%= message.offerID.tasks[i].totalPrice
																																			%>
																																	</h5>
																																	<i
																																		class="fas fa-dollar-sign"></i>
																																</div>
																															</div>
																												</div>
																											</div>
																										</div>
																									</div>
																									<% }%>
																							</div>
																							<div
																								class="offer_facts_buttons">
																								<div
																									class="offer_facts total_facts">
																									<div
																										class="single_fact">
																										<h6>Sub Total
																										</h6>
																										<div
																											class="tiny_box tiny_box_usd">
																											<h5>
																												<%= message.offerID.subTotal
																													%>
																											</h5>
																											<i
																												class="fas fa-dollar-sign"></i>
																										</div>
																									</div>
																									<div
																										class="single_fact">
																										<h6>Delivery
																										</h6>
																										<div
																											class="tiny_box tiny_box_usd">
																											<h5>
																												<%= message.offerID.totalDuration
																													%>
																													Days
																											</h5>
																											<i
																												class="far fa-clock"></i>
																										</div>
																									</div>
																									<div
																										class="single_fact">
																										<h6>Gabazzo Fee
																										</h6>
																										<div
																											class="tiny_box">
																											<h5>5%
																											</h5>
																										</div>
																									</div>
																									<div
																										class="single_fact">
																										<h6>Revisions
																										</h6>
																										<div
																											class="tiny_box tiny_box_usd">
																											<h5>
																												<%= message.offerID.revision
																													%>
																											</h5>
																											<i
																												class="fas fa-sync-alt"></i>
																										</div>
																									</div>
																									<div
																										class="single_fact">
																										<h6>Quote Total
																										</h6>
																										<div
																											class="tiny_box tiny_box_usd">
																											<h5>
																												<%= message.offerID.totalCost
																													%>
																											</h5>
																											<i
																												class="fas fa-dollar-sign"></i>
																										</div>
																									</div>
																								</div>
																								<%
																									if(message.messages.sender.id._id.toString()===user._id.toString()){%>
																									<div
																										class="offer_buttons">
																										<div
																											class="left_buttons">
																											<ul>
																												<li><a href="https://s3.amazonaws.com/assets.gabazzo.com/<%= message.offerID._id %>.pdf"
																														target="_blank"
																														class="gbtn gbtn_orange_bdr">View
																														PDF
																														File</a>
																												</li>
																											</ul>
																										</div>
																										<div
																											class="right_buttons">
																											<ul>
																												<% if(message.offerID.status==='withdrawn'
																													) {
																													%>
																													<ul>
																														<li> <b> Offer
																																Withdrawn
																															</b>
																														</li>
																													</ul>
																													<%} else
																														if(message.offerID.status==='accepted'
																														)
																														{%>
																														<ul>
																															<li
																																style="font-family: fangsong; color:green">
																																<b> Offer
																																	Accepted
																																</b>
																															</li>
																														</ul>
																														<%} else
																															if(message.offerID.status==='declined'
																															)
																															{%>
																															<ul>
																																<li
																																	style="font-family: fangsong; color:red">
																																	<b> Offer
																																		Declined
																																	</b>
																																</li>
																															</ul>
																															<%} else
																																{%>
																																<ul>
																																	<li
																																		id="wd<%= message.offerID._id %>">
																																		<button
																																			id=<%=message.offerID._id
																																			%>
																																			class="btn
																																			gbtn
																																			gbtn_bdr
																																			btnWithdraw">Withdraw
																																			Offer</button>
																																	</li>
																																</ul>
																																<%
																																	}%>
																											</ul>
																										</div>
																									</div>
																									<% } else { %>
																										<div
																											class="offer_buttons">
																											<div
																												class="left_buttons">
																												<ul>
																													<li><a href="https://s3.amazonaws.com/assets.gabazzo.com/<%= message.offerID._id %>.pdf"
																															target="_blank"
																															class="gbtn gbtn_orange_bdr">View
																															PDF
																															File</a>
																													</li>
																												</ul>
																											</div>
																											<div
																												class="right_buttons">
																												<ul>
																													<% if(message.offerID.status==='withdrawn'
																														)
																														{
																														%>
																														<ul>
																															<li> <b> Offer
																																	Withdrawn
																																</b>
																															</li>
																														</ul>
																														<%} else
																															if(message.offerID.status==='accepted'
																															)
																															{%>
																															<ul>
																																<li
																																	style="font-family: fangsong; color:green">
																																	<b> Offer
																																		Accepted
																																	</b>
																																</li>
																															</ul>
																															<%} else
																																if(message.offerID.status==='declined'
																																)
																																{%>
																																<ul>
																																	<li
																																		style="font-family: fangsong; color:red">
																																		<b> Offer
																																			Declined
																																		</b>
																																	</li>
																																</ul>
																																<%} else
																																	{%>
																																	<ul
																																		id="repButtons<%= message.offerID._id %>">
																																		<li><button
																																				id='decline<%= message.offerID._id %>'
																																				type="submit"
																																				class="btn gbtn gbtn_bdr btnDec">Decline
																																				Offer</button>
																																		</li>
																																		<li><button
																																				id='accept<%= message.offerID._id %>'
																																				type="submit"
																																				class="btn gbtn btnAcp">Accept
																																				Offer</button>
																																		</li>
																																	</ul>
																																	<%
																																		}%>
																												</ul>
																											</div>
																										</div>
																										<% } %>
																							</div>
																						</div>
																					</div>
																					<% } else { %>
																						<p>
																							<%= message.messages.text%>
																								<br />
																						</p>
																						<div
																							class="msg_attachments_files">
																							<% if(message.messages.attachments
																								!=undefined) {%>
																								<% message.messages.attachments.forEach(function(file)
																									{%>
																									<% let
																										fileAddr=file.url;
																										let
																										tempfn=fileAddr.split("/");
																										let
																										fileName=file?.name;
																										fileAddr.replace("/raw/upload", "/files"
																										); %>
																										<% if(file.type==='jpg'
																											||
																											file.type==='jpeg'
																											||
																											file.type==='png'
																											||
																											file.type==='gif'
																											) {%>
																											<div
																												class="msg_attachment_items">
																												<a href="<%=file.url%>"
																													class="img-thumbnail"
																													rel="noopener noreferrer"
																													target="_blank"
																													download><img
																														src="<%=file.url%>"
																														width="400px"
																														class="img-thumbnail"
																														loading="lazy" /></a>
																											</div>
																											<% } else if
																												(file.url.substr(file.url.length
																												-
																												3)==='doc'
																												||
																												file.url.substr(file.url.length
																												-
																												4)==='docx'
																												||
																												file.url.substr(file.url.length
																												-
																												3)==='odt'
																												||
																												file.url.substr(file.url.length
																												-
																												3)==='txt'
																												) {%>
																												<div
																													class="msg_attachment_items">
																													<a href="<%=fileAddr%>"
																														class="file-links doc-link"
																														target="_blank"
																														download>
																														<%=fileName%>
																													</a>
																												</div>
																												<% } else
																													if
																													(file.url.substr(file.url.length
																													-
																													3)==='pdf'
																													)
																													{%>
																													<div
																														class="msg_attachment_items">
																														<a href="<%=fileAddr%>"
																															class="file-links pdf-link"
																															target="_blank"
																															download>
																															<%=fileName%>
																														</a>
																													</div>
																													<% } else
																														if
																														(file.url.substr(file.url.length
																														-
																														3)==='zip'
																														||
																														file.url.substr(file.url.length
																														-
																														3)==='rar'
																														)
																														{%>
																														<div
																															class="msg_attachment_items">
																															<a href="<%=fileAddr%>"
																																class="file-links zip-link"
																																target="_blank"
																																download>
																																<%=fileName%>
																															</a>
																														</div>
																														<% } else
																															if
																															(file.url.substr(file.url.length
																															-
																															3)==='mp4'
																															||
																															file.url.substr(file.url.length
																															-
																															3)==='ogg'
																															||
																															file.url.substr(file.url.length
																															-
																															3)==='webm'
																															||
																															file.url.substr(file.url.length
																															-
																															3)==='mkv'
																															||
																															file.url.substr(file.url.length
																															-
																															3)==='mov'
																															)
																															{%>
																															<div class="msg_attachment_items"
																																height="200px"
																																width="160px">
																																<video
																																	width="50%"
																																	height="100%"
																																	controls>
																																	<source
																																		src="<%=file.url%>"
																																		type="video/mp4">
																																	<source
																																		src="<%=file.url%>"
																																		type="video/ogg">
																																</video>
																															</div>
																															<% } else
																																{
																																%>
																																<div
																																	class="msg_attachment_items">
																																	<a href="<%=fileAddr%>"
																																		class="file-links other-link"
																																		target="_blank"
																																		download>
																																		<%=fileName%>
																																	</a>
																																</div>
																																<% }
																																	%>
																																	<% });
																																		}
																																		%>
																						</div>
																						<div class="msg_time_actions">
																							<div
																								class="msg_time grid_item">
																								<time>
																									<%=
																										message.timeAgo%>
																								</time>
																							</div>
																						</div>
																						<% } %>
																			</div>
																		</div>
														</div>
														<% } %>
															<% }) %>
									</div>
								</div>
								<!--===== Markup For "Sent & Received SMS" Ends Here =====-->
								<!--===== Markup For "Message Actions" Starts From Here =====-->
								<% if(currentUser.isCompany) {%>
									<div class="conversation_footer">
										<% } else { %>
											<div class="conversation_footer conversation_footer_members">
												<% } %>
													<div class="message_box">
														<textarea name="" id="textarea"
															placeholder="Type Your Message..." cols="30"
															rows="1"></textarea>
													</div>
													<div class="sending_actions">
														<div class="left_btns">
															<ul id="sending_options">
																<li id="upload_widget">
																	<label class="attachment gbtn">
																		<img src="../images/attachment_icon_blue.png"
																			class="img-fluid blue_icon" alt="" />
																		<img src="../images/attachment_icon_white.png"
																			class="img-fluid white_icon" alt="" />
																		<span class="attach_texts">Attach File</span>
																		<!-- <input class="file_attachment" id="" name="" type="file"> -->
																	</label>
																</li>
																<% if(currentUser.isCompany) { %>
																	<li><a class="create_offer_btn"
																			href="javascript:void(0)"
																			data-target="#selectService"
																			data-toggle="modal" id="modalOpen">Create
																			Offer</a></li>
																	<% } %>
																		<li class="dropdown">
																			<a class="quick_msg_btn"
																				href="javascript:void(0)"
																				data-target="#allQuickSms"
																				data-toggle="dropdown">
																				<img title="Quick Reply"
																					data-toggle="tooltip"
																					src="../images/quic_msg_icon_blue.png"
																					class="img-fluid blue_icon"
																					alt="" />
																				<img title="Quick Reply"
																					data-toggle="tooltip"
																					src="../images/quic_msg_icon_white.png"
																					class="img-fluid white_icon"
																					alt="" />
																			</a>
																			<div class="dropdown-menu quick_sms_down"
																				aria-labelledby="allQuickSms">
																				<div class="all_quick_sms">
																					<div class="single_quick_sms">
																						<div class="created_sms">
																							<p class="qtext">Thank you
																								purchasing with us, we
																								appreciate your order.
																							</p>
																						</div>
																						<div class="sms_footer">
																							<div class="sms_title">
																								<h5>Business Info</h5>
																							</div>
																							<div class="sms_actions">
																								<div class="use_this">
																									<a href="javascript:void(0)"
																										class="sendQM">Use
																										This</a>
																								</div>
																								<div
																									class="edit_delete grid_item">
																									<ul>
																										<li><a title="Edit"
																												data-toggle="tooltip"
																												href="javascript:void(0)"
																												class="editQM"><img
																													src="../images/edit_icon.png"
																													class="img-fluid"
																													alt="" /></a>
																										</li>
																										<!-- <li><a title="Delete" data-toggle="tooltip" href="javascript:void(0)"><img src="../images/trash_icon.png" class="img-fluid" alt="" /></a></li> -->
																									</ul>
																								</div>
																							</div>
																						</div>
																					</div>
																					<div class="single_quick_sms">
																						<div class="created_sms">
																							<p class="qtext">Hi there!
																								welcome to BUSINESS
																								Name. We're located at
																								address. To get in
																								touch, call PHONE NUMBER
																								We...</p>
																						</div>
																						<div class="sms_footer">
																							<div class="sms_title">
																								<h5>Business Info</h5>
																							</div>
																							<div class="sms_actions">
																								<div class="use_this">
																									<a href="javascript:void(0)"
																										class="sendQM">Use
																										This</a>
																								</div>
																								<div
																									class="edit_delete grid_item">
																									<ul>
																										<li><a title="Edit"
																												data-toggle="tooltip"
																												href="javascript:void(0)"
																												class="editQM"><img
																													src="../images/edit_icon.png"
																													class="img-fluid"
																													alt="" /></a>
																										</li>
																										<!-- <li><a title="Delete" data-toggle="tooltip" href="javascript:void(0)"><img src="../images/trash_icon.png" class="img-fluid" alt="" /></a></li> -->
																									</ul>
																								</div>
																							</div>
																						</div>
																					</div>
																					<div class="single_quick_sms">
																						<div class="created_sms">
																							<p class="qtext">Thank you
																								purchasing with us, we
																								appreciate your order.
																							</p>
																						</div>
																						<div class="sms_footer">
																							<div class="sms_title">
																								<h5>Business Info</h5>
																							</div>
																							<div class="sms_actions">
																								<div class="use_this">
																									<a href="javascript:void(0)"
																										class="sendQM">Use
																										This</a>
																								</div>
																								<div
																									class="edit_delete grid_item">
																									<ul>
																										<li><a title="Edit"
																												data-toggle="tooltip"
																												href="javascript:void(0)"
																												class="editQM"><img
																													src="../images/edit_icon.png"
																													class="img-fluid"
																													alt="" /></a>
																										</li>
																										<!-- <li><a title="Delete" data-toggle="tooltip" href="javascript:void(0)"><img src="../images/trash_icon.png" class="img-fluid" alt="" /></a></li> -->
																									</ul>
																								</div>
																							</div>
																						</div>
																					</div>
																					<div class="single_quick_sms">
																						<div class="created_sms">
																							<p class="qtext">Thank you
																								purchasing with us, we
																								appreciate your order.
																							</p>
																						</div>
																						<div class="sms_footer">
																							<div class="sms_title">
																								<h5>Business Info</h5>
																							</div>
																							<div class="sms_actions">
																								<div class="use_this">
																									<a href="javascript:void(0)"
																										class="sendQM">Use
																										This</a>
																								</div>
																								<div
																									class="edit_delete grid_item">
																									<ul>
																										<li><a title="Edit"
																												data-toggle="tooltip"
																												href="javascript:void(0)"
																												class="editQM"><img
																													src="../images/edit_icon.png"
																													class="img-fluid"
																													alt="" /></a>
																										</li>
																										<!-- <li><a title="Delete" data-toggle="tooltip" href="javascript:void(0)"><img src="../images/trash_icon.png" class="img-fluid" alt="" /></a></li> -->
																									</ul>
																								</div>
																							</div>
																						</div>
																					</div>
																					<div class="single_quick_sms">
																						<div class="created_sms">
																							<p class="qtext">Thank you
																								purchasing with us, we
																								appreciate your order.
																							</p>
																						</div>
																						<div class="sms_footer">
																							<div class="sms_title">
																								<h5>Business Info</h5>
																							</div>
																							<div class="sms_actions">
																								<div class="use_this">
																									<a href="javascript:void(0)"
																										class="sendQM">Use
																										This</a>
																								</div>
																								<div
																									class="edit_delete grid_item">
																									<ul>
																										<li><a title="Edit"
																												data-toggle="tooltip"
																												href="javascript:void(0)"
																												class="editQM"><img
																													src="../images/edit_icon.png"
																													class="img-fluid"
																													alt="" /></a>
																										</li>
																										<!-- <li><a title="Delete" data-toggle="tooltip" href="javascript:void(0)"><img src="../images/trash_icon.png" class="img-fluid" alt="" /></a></li> -->
																									</ul>
																								</div>
																							</div>
																						</div>
																					</div>
																					<!-- <div class="single_quick_sms create_fast_reply">
														<div class="create_reply">
															<a href="javascript:void(0)">
																<i class="fas fa-plus"></i>
																<span>Create Fast Reply</span>
															</a>
														</div>
													</div> -->
																				</div>
																			</div>
																		</li>
															</ul>
															<div id="status" class="label text-success"></div>
														</div>
														<div class="send_btn">
															<button type="submit" id="sendMsgBtn"
																class="btn">Send</button>
														</div>
													</div>
											</div>
											<!--===== Markup For "Message Actions" Ends Here =====-->
									</div>
							</div>
							<!--===== Markup For "User Info" Starts From Here =====-->
							<div class="gb_info">
								<a href="javascript:void(0)" class="close_gb_info_link"><img
										src="../images/circle_times.png" class="img-fluid" alt="" /></a>
								<div class="profile_info">
									<% if(otherUser.isCompany) {%>
										<div class="profile_link_image">
											<% if(otherUser.logo) {%>
												<a href="../company-profile/<%= otherUser.id %>"><img
														src="<%= otherUser.logo %>" alt="" /></a>
												<%} else {%>
													<a href="../company-profile/<%= otherUser.id %>"><img
															src="../images/man.png" alt="" /></a>
													<% }%>
														<% if (otherUser.status) { %>
															<span class="activity_status online_status"></span>
															<% } else { %>
																<span class="activity_status offline_status"></span>
																<% } %>
										</div>
										<div class="profile_user_link">
											<a style="text-transform: capitalize;"
												href="../company-profile/<%= otherUser.id %>">
												<%= otherUser.companyName %>
											</a>
											<div class="company_ratings">
												<% let intValue=parseInt(averageRating), flagValue=false; leftOver=0 %>
													<% for(let i=0; i< intValue; i++){ %>
														<i class="fas fa-star"></i>
														<% }%>
															<% leftOver=5 - intValue %>
																<% if(!Number.isInteger(averageRating)){ %>
																	<% let decimalPart=averageRating % 1; %>
																		<% if(decimalPart==0.5){ %>
																			<i class="fas fa-star-half-alt"></i>
																			<% flagValue=true %>
																				<% } else if(Math.round(decimalPart)>
																					0.5) { %>
																					<i class="fas fa-star"></i>
																					<% flagValue=true %>
																						<% } %>
																							<% }%>
																								<% if(flagValue) {%>
																									<% leftOver=leftOver
																										- 1 %>
																										<% } %>
																											<% for(let
																												i=0; i<
																												leftOver;
																												i++){ %>
																												<i
																													class="far fa-star"></i>
																												<% }%>
																													<span
																														class="review_amount">(
																														<%= review.length
																															%>
																															)
																													</span>
											</div>
										</div>
										<div class="cp_address_lang">
											<div class="single_part">
												<h6>Address:</h6>
												<p>
													<%= otherUser?.location %>
												</p>
											</div>
											<div class="single_part">
												<h6>Languages:</h6>
												<p style="text-transform: capitalize;">
													<%= otherUser?.language %>
												</p>
											</div>
										</div>
										<% } else { %>
											<div class="profile_link_image">
												<% if(otherUser.profilePicture) {%>
													<a href="../profile/<%= otherUser.id %>"><img
															src="<%= otherUser.profilePicture %>" alt="" /></a>
													<%} else {%>
														<a href="../profile/<%= otherUser.id %>"><img
																src="../images/man.png" alt="" /></a>
														<% }%>
															<% if (otherUser.status) { %>
																<span class="activity_status online_status"></span>
																<% } else { %>
																	<span class="activity_status offline_status"></span>
																	<% } %>
											</div>
											<div class="profile_user_link">
												<a href="../member-profile/<%= otherUser.id %>">
													<%= otherUser.firstName + " " + otherUser.lastName %>
												</a>
											</div>
											<div class="member_location">
												<p><span style="text-transform: capitalize;">
														<%= otherUser?.city %>
													</span>, <span style="text-transform: capitalize;">
														<%= otherUser?.country %>
													</span></p>
											</div>
											<% } %>
								</div>
								<% if(currentUser.isCompany) {%>
									<div class="user_files_manage">
										<% } else { %>
											<div class="user_files_manage user_files_manage_members">
												<% } %>
													<section id="filesManageTabs">
														<div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
															<a class="nav-item nav-link active" id="theFiles_tab"
																data-toggle="tab" href="#theFiles" role="tab"
																aria-controls="theFiles" aria-selected="true">Files</a>
															<a class="nav-item nav-link" id="theManage_tab"
																data-toggle="tab" href="#theManage" role="tab"
																aria-controls="theManage"
																aria-selected="false">Manage</a>
														</div>
														<div class="tab-content" id="nav-tabContent">
															<div class="tab-pane fade show active" id="theFiles"
																role="tabpanel" aria-labelledby="theFiles_tab">
																<div class="the_contents files_contents">
																	<h5>Uploaded Files</h5>
																	<ul id="fileList">
																		<% messages?.forEach(function(message){ %>
																			<% if(message.messages.attachments
																				!=undefined) {%>
																				<% message.messages.attachments.forEach(function(file)
																					{%>
																					<% let fileAddr=file.url; let
																						tempfn=fileAddr.split("/"); let
																						fileName=file?.name;
																						fileAddr.replace("/raw/upload", "/files"
																						); %>
																						<% if
																							(file.url.substr(file.url.length
																							- 3)==='doc' ||
																							file.url.substr(file.url.length
																							- 4)==='docx' ||
																							file.url.substr(file.url.length
																							- 3)==='odt' ||
																							file.url.substr(file.url.length
																							- 3)==='txt' ) {%>
																							<li
																								class="file_type doc_file">
																								<a href="<%= fileAddr %>"
																									target="_blank">
																									<%= fileName %>
																								</a>
																							</li>
																							<% } else if
																								(file.url.substr(file.url.length
																								- 3)==='pdf' ) {%>
																								<li
																									class="file_type pdf_file">
																									<a href="<%= fileAddr %>"
																										target="_blank">
																										<%= fileName %>
																									</a>
																								</li>
																								<% } else if
																									(file.url.substr(file.url.length
																									- 3)==='zip' ||
																									file.url.substr(file.url.length
																									- 3)==='rar' ) {%>
																									<li
																										class="file_type zip_file">
																										<a href="<%= fileAddr %>"
																											target="_blank">
																											<%= fileName
																												%>
																										</a>
																									</li>
																									<% } else {%>
																										<li
																											class="file_type zip_file">
																											<a href="<%= fileAddr %>"
																												target="_blank">
																												<%= fileName
																													%>
																											</a>
																										</li>
																										<% } %>
																											<% }) %>
																												<% } %>
																													<% })
																														%>
																	</ul>
																</div>
															</div>
															<div class="tab-pane fade" id="theManage" role="tabpanel"
																aria-labelledby="theManage_tab">
																<div class="the_contents manage_contents">
																	<div class="single_manage">
																		<div class="manage_heading">
																			<div class="manage_title grid_item">
																				<h6>Tasks & Reminders</h6>
																			</div>
																			<!-- <div class="add_button">
													<button type="submit" class="btn">ADD</button>
												</div> -->
																		</div>
																		<div class="manage_field">
																			<textarea class="form-control"
																				placeholder="Write your taks here and hit enter..."
																				name="" id="taskData" cols="30"
																				rows="3"><%= otherUser?.reminder %>  </textarea>
																			<button type="button" class="btn"
																				onclick="TaskSend()">Done</button>
																		</div>
																	</div>
																	<div class="single_manage">
																		<div class="manage_heading">
																			<div class="manage_title grid_item">
																				<h6>Notes</h6>
																			</div>
																			<!-- <div class="add_button">
													<button type="submit" class="btn">ADD</button>
												</div> -->
																		</div>
																		<div class="manage_field">
																			<textarea class="form-control"
																				placeholder="Write your notes about this content..."
																				name="" id="noteData" cols="30"
																				rows="3"><%= otherUser?.notes %> </textarea>
																			<button type="submit" class="btn"
																				onclick="noteSend()">Done</button>
																		</div>
																	</div>
																</div>
															</div>
														</div>
													</section>
											</div>
									</div>
									<!--===== Markup For "User Info" Ends Here =====-->
							</div>
				</section>

				<!--===== Markup For "Select Address Modal" Starts From Here =====-->
				<% if(!isBillingAvailable) { %>
					<div class="modal fade create_offer_modal" id="deliveryToAddress">
						<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
							<div class="modal-content">
								<div class="modal-header">
									<h3>Select Delivery To Address</h3>
									<button type="button" class="close" data-dismiss="modal">&times;</button>
								</div>
								<div class="modal-body">
									<div class="delivery_to_address">
										<div class="title">
											<h4>Please Tell The Member The Following</h4>
										</div>

										<div class="following_input">
											<textarea name="" id="billingInformationModal" cols="30" rows="4" class="form-control" disabled></textarea>
										</div>
				
										<div class="submit_button">
											<a href="javascript:void(0)" class="gbtn" id="cpytoclipboard">Copy to Clipboard</a>
										</div>
									</div>
								</div>
								<div class="modal-footer">
									<div class="go_back_button">
										<a href="javascript:void(0)" class="gbtn gbtn_orange" data-dismiss="modal" data-target="#selectService" data-toggle="modal">Go Back</a>
									</div>

									<div class="modal_actions">
										<ul>
											<li><a href="javascript:void(0)" class="gbtn gbtn_bdr" data-dismiss="modal">Cancel</a></li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				<% } else { %>
					<!--===== Markup For "Select Address Modal" Starts From Here =====-->
					<div class="modal fade create_offer_modal" id="deliveryToAddress">
						<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
							<div class="modal-content">
								<div class="modal-header">
									<h3>Select Delivery To Address</h3>
									<button type="button" class="close" data-dismiss="modal">&times;</button>
								</div>
								<div class="modal-body">
									<div class="delivery_to_address">
										<div class="title">
											<h4>Members Addresses</h4>
										</div>

										<ul data-toggle="buttons" class="accordion" id="deliveryAddresses">
											<% for(let i = 0; i< otherUser.billing?.deliverTo?.length; i++) { %>
											<li class="btn userbilling" id="<%= i %>">
												<input type="radio" name="deliveryAddres" autocomplete="off" > 
												<h5><%= i+1 %>.  <%= otherUser.billing.deliverTo[i].location %></h5>
												<a href="#collapse<%=i%>" class="collapsed address_toggler" data-toggle="collapse"></a>

												<div id="collapse<%=i%>" class="collapse contents" data-parent="#deliveryAddresses">
													<div class="single_address">
														<ul>
															<li><span>Name:</span> <%= otherUser.billing.deliverTo[i].name %> </li>
															<li><span>Address:</span> <%= otherUser.billing.deliverTo[i].location %> </li>
															<li><span>Company Name:</span>  <%= otherUser.billing.deliverTo[i].companyName %> </li>
															<li><span>Phone Number:</span>  <%= otherUser.billing.deliverTo[i].phoneNumber %> </li>
															<li><span>Email:</span>  <%= otherUser.billing.deliverTo[i].email %> </li>
														</ul>
													</div>
												</div>
											</li>
											<% } %>
										</ul>
									</div>
								</div>

								<div class="modal-footer">
									<div class="go_back_button">
										<a href="javascript:void(0)" class="gbtn gbtn_orange" data-dismiss="modal" data-target="#selectService" data-toggle="modal">Go Back</a>
									</div>

									<div class="modal_actions">
										<ul>
											<li><a href="javascript:void(0)" class="gbtn gbtn_bdr" data-dismiss="modal">Cancel</a></li>
											<li><a href="javascript:void(0)" class="gbtn continue" id="addressmodalbtn">Continue</a></li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!--===== Markup For "Select Address Modal" Ends Here =====-->
				<% } %>
				<!--===== Markup For "Select Address Modal" Ends Here =====-->


				<!--===== Markup For "Order History Modal" Starts From Here =====-->
				<!-- <div class="modal fade order_history_modal" id="theOrderHistory">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h3>Order History</h3>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>
					<div class="modal-body">
						<div class="table-responsive">
							<table class="table table-bordered">
								<thead>
									<tr>
										<th>Member Order Details</th>
										<th>P.O #</th>
										<th>Order Date</th>
										<th>Finished On</th>
										<th>Total</th>
										<th>Status</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="../images/customerservice_1.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">Janice Watson</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_orange">In Progress</span></td>
									</tr>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="../images/customerservice_2.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">John deo</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_green">Completed</span></td>
									</tr>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="../images/customerservice_1.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">Janice Watson</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_orange">In Progress</span></td>
									</tr>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="../images/customerservice_2.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">John deo</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_green">Completed</span></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div> -->
				<!--===== Markup For "Order History Modal" Starts From Here =====-->
		<div class="modal fade order_history_modal" id="theOrderHistory">
			<div class="modal-dialog modal-lg modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<h3>Order History</h3>
						<button type="button" class="close" data-dismiss="modal">&times;</button>
					</div>

					<div class="modal-body">
						<div class="table-responsive">
							<table class="table table-bordered">
								<thead>
									<tr>
										<th>Member Order Details</th>
										<th>P.O #</th>
										<th>Order Date</th>
										<th>Finished On</th>
										<th>Total</th>
										<th>Status</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="images/customerservice_1.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">Janice Watson</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_orange">In Progress</span></td>
									</tr>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="images/customerservice_2.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">John deo</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_green">Completed</span></td>
									</tr>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="images/customerservice_1.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">Janice Watson</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_orange">In Progress</span></td>
									</tr>
									<tr>
										<td class="member_info_column">
											<div class="member_info">
												<div class="service_photo grid_item">
													<a href="javascript:void(0)"><img src="images/customerservice_2.png" class="img-fluid" alt=""></a>
												</div>
												<div class="member_texts">
													<div class="member_name">
														<a href="javascript:void(0)">John deo</a>
													</div>
													<div class="member_address">
														<h6><span class="light_texts">Address:</span> Janice1715 N Gabazzo Ave Watson</h6>
													</div>
												</div>
											</div>
										</td>
										<td>513POL</td>
										<td>Aug 8, 2021</td>
										<td>Aug 8, 2021</td>
										<td>$80</td>
										<td><span class="gbadge gbadge_green">Completed</span></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--===== Markup For "Order History Modal" Ends Here =====-->
		
		
				<!--===== Markup For "Select Service Modal" Starts From Here =====-->
				<div class="modal fade create_offer_modal" data-backdrop="static" id="selectService">
					<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header">
								<h3>Select Service</h3>
								<button type="button" class="close cancelBtn" data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body">
								<div class="select_services">
									<form action="">
										<ul data-toggle="buttons">
											<% services.forEach((service, i)=> { %>
												<li class="btn serviceSelect" id="<%= service.title[0] + i%>">
													<input type="radio" name="theService" autocomplete="off">
													<div class="single_service">
														<div class="service_image">
															<% if(service.images.length) {%>
																<img src="<%= service.images[0].url %>"
																	class="img-fluid" alt="<%= service.title %>" />
																<%} else {%>
																	<img src="../images/Roofing_Services.jpg"
																		class="img-fluid" alt="<%= service.title %>" />
																	<% }%>
														</div>
														<div class="service_title">
															<h4 id="<%= service._id %>">
																<%= service.title %>
															</h4>
														</div>
													</div>
												</li>
												<% }) %>
										</ul>
										<div class="label text-danger" id="selectService_val" style="display: none;">
											Please select a service! </div>
									</form>
								</div>
							</div>
							<div class="modal-footer">
								<div class="modal_actions">
									<ul>
										<li><a href="javascript:void(0)" class="gbtn gbtn_bdr cancelBtn"
												data-dismiss="modal">Cancel</a></li>
										<li><a href="javascript:void(0)" class="gbtn continue" id="serviceCon"
												data-toggle="modal">Continue</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--===== Markup For "Select Service Modal" Ends Here =====-->
				<!--===== Markup For "Payment Way Modal" Starts From Here =====-->
				<div class="modal fade create_offer_modal" data-backdrop="static" id="singleMilestones">
					<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header">
								<h3>How would <a href="javascript:void(0)">Company Name</a> get paid?</h3>
								<button type="button" class="close cancelBtn" data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body">
								<div class="top_texts">
									<p>Get paid in full to work on Project or break it into smaller chunks to get paid
										as you work along the the way <a href="javascript:void(0)"
											title="Milestones allow you to work through large projects in small steps with pre-defined deadlines, deliverables, and payments. It's a great way to build trust with your buyer, step-by-step."
											data-toggle="tooltip"><i class="fa fa-question-circle"
												aria-hidden="true"></i></a></p>
								</div>
								<div class="select_payment">
									<form action="">
										<ul data-toggle="buttons" class="paymentSelect">
											<li class="btn" id="singleP">
												<input type="radio" name="paymentSystem" autocomplete="off">
												<div class="single_payment">
													<div class="icon">
														<img src="../images/single_payment.png" class="img-fluid"
															alt="" />
													</div>
													<div class="texts">
														<h2>Single Payment</h2>
														<p>Receive one payment for the entire project once completed.
														</p>
													</div>
												</div>
											</li>
										</ul>
									</form>
								</div>
							</div>
							<div class="modal-footer">
								<div class="go_back_button">
									<a href="javascript:void(0)" class="gbtn gbtn_orange gbsel" data-dismiss="modal"
										data-target="#selectService" data-toggle="modal">Go Back</a>
								</div>
								<div class="modal_actions modal_continue_payment">
									<ul>
										<li><a href="javascript:void(0)" class="gbtn gbtn_bdr cancelBtn"
												data-dismiss="modal">Cancel</a></li>
										<li><a href="javascript:void(0)" class="gbtn continue" id="continuepay"
												data-toggle="modal">Continue</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--===== Markup For "Payment Way Modal" Ends Here =====-->

				<!--===== Markup For "Single Payment Modal" Starts From Here =====-->
				<div class="modal fade create_offer_modal payment_method_modal" data-backdrop="static"
					id="singlePaymentSt1">
					<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header">
								<h3>Create Single Payment Offer</h3>
								<button type="button" class="close cancelBtn" data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body">
								<div class="creating_offer">
									<form action="">
										<div class="title">
											<h4 id="sp1title">Service Name/Service Title</h4>
										</div>
										<div class="proposal_wrap">
											<div class="service_image pay1">
												<img src="" class="img-fluid" alt="" />
											</div>
											<div class="describe_offer">
												<textarea name="" class="form-control" id="sp1do" cols="30" rows="4"
													placeholder="Describe Your System..."></textarea>
											</div>
										</div>
										<div class="label text-danger" id="derrorsp1" style="display: none;"> Provide a
											description! </div>
										<div class="set_offer_wrap">
											<div class="title">
												<h4>Set Up Offer</h4>
											</div>
											<div class="offer_box set_offer">
												<div class="single_field the_qty_field">
													<div class="label_wrap">
														<label for="">QTY:</label>
													</div>
													<select name="" id="sp1qty" class="form-control">
														<option value=""></option>
														<option value="1">1</option>
														<option value="2">2</option>
														<option value="3">3</option>
														<option value="4">4</option>
														<option value="5">5</option>
														<option value="6">6</option>
														<option value="7">7</option>
														<option value="8">8</option>
														<option value="9">9</option>
														<option value="10">10</option>
													</select>
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Unit Price:</label>
													</div>
													<div class="input_icon">
														<input type="number" id="sp1up" class="form-control"
															placeholder="25,000 Max" />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Total:</label>
													</div>
													<div class="input_icon">
														<input type="text" id="sp1tot" class="form-control"
															placeholder="1,000,000 Max" readonly />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
											</div>
										</div>
										<div class="row">
											<div class="col-sm-1"></div>
											<div class="col-sm-2 label text-danger" style="display: none;"
												id="qerrorsp1"> Add Quantity! </div>
											<div class="col-sm-2"></div>
											<div class="col-sm-2 label text-danger text-right" style="display: none;"
												id="uperrorsp1"> Add Unit Price! </div>
										</div>
										<div class="created_milestones" id="createdSingles"></div>
										<div class="add_create_btns">
											<ul>
												<li><a href="javascript:void(0)" class="gbtn" id="sp1add"><i
															class="fas fa-plus"></i> Add</a></li>
											</ul>
										</div>
									</form>
									<div class="label text-danger" id="sp1_emp" style="display: none;"> Add at least one
										service! </div>
								</div>
							</div>
							<div class="modal-footer">
								<div class="go_back_button">
									<a href="javascript:void(0)" class="gbtn gbtn_orange gbpay" data-dismiss="modal"
										data-target="#singleMilestones" data-toggle="modal">Go Back</a>
								</div>
								<div class="modal_actions">
									<ul>
										<li><a href="javascript:void(0)" class="gbtn gbtn_bdr cancelBtn"
												data-dismiss="modal">Cancel</a></li>
										<li><a href="javascript:void(0)" id="sp1Con" data-toggle="modal"
												class="gbtn continue">Continue</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal fade create_offer_modal payment_method_modal" data-backdrop="static"
					id="singlePaymentSt2">
					<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header">
								<h3>Single Payment Final Details</h3>
								<button type="button" class="close cancelBtn" data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body">
								<div class="creating_offer">
									<form action="">
										<div class="final_offer">
											<div class="title">
												<h4>Offer Final Details</h4>
											</div>
											<div class="offer_box delivery_revisions">
												<div class="single_field delivery_field">
													<div class="label_wrap">
														<label for="">Delivery <a href="javascript:void(0)"
																title="The order duration might change depending on the back and forth communications between buyer and seller."
																data-toggle="tooltip"><i class="fa fa-question-circle"
																	aria-hidden="true"></i></a></label>
													</div>
													<div class="input_icon">
														<select name="" id="numDays" class="form-control">
															<option value="1" selected>1 Day</option>
															<option value="2">2 Days</option>
															<option value="3">3 Days</option>
															<option value="4">4 Days</option>
															<option value="5">5 Days</option>
															<option value="6">6 Days</option>
															<option value="7">1 Week</option>
															<option value="14">2 Weeks</option>
															<option value="21">3 Weeks</option>
															<option value="30">1 Month (30 Days)</option>
															<option value="60">2 Months (60 Days)</option>
															<option value="90">3 Months (90 Days)</option>
														</select>
														<i class="far fa-clock"></i>
													</div>
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Revisions <span>(Optional)</span></label>
													</div>
													<div class="input_icon">
														<select name="" id="numRevisions" class="form-control">
															<option value="">Select</option>
															<option value="0">0</option>
															<option value="1">1</option>
															<option value="2">2</option>
															<option value="3">3</option>
															<option value="4">4</option>
															<option value="5">5</option>
															<option value="6">6</option>
															<option value="7">7</option>
														</select>
														<i class="fas fa-sync-alt"></i>
													</div>
												</div>
											</div>
											<div class="offer_box pricing_details">
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Sub-Total</label>
													</div>
													<div class="input_icon">
														<input type="text" class="form-control" placeholder=""
															id="sp2subtot" readonly />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Discount</label>
													</div>
													<div class="input_icon">
														<input type="number" class="form-control" placeholder=""
															id="sp2discount" />
														<i class="fas fa-dollar-sign"></i>
													</div>
													<div class="label text-danger" id="discountAlert"
														style="display: none;"> Add discount value! </div>
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Tax</label>
													</div>
													<div class="input_icon">
														<input type="number" class="form-control"
															id="tax" name="tax"/>
														<i class="fas fa-percentage"></i>
													</div>
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Gabazzo Rate</label>
													</div>
													<input type="text" class="form-control" disabled value="5%"
														placeholder="" id="" />
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Quote Total</label>
													</div>
													<div class="input_icon">
														<input type="text" class="form-control" placeholder=""
															id="sp2quote" readonly />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-sm-2 labael text-danger" id="highdis1"
													style="display: none;"> Discount too high! </div>
											</div>
											<div class="notes">
												<div class="title">
													<h4>Notes</h4>
												</div>
												<textarea name="" id="sp2notes" cols="30" rows="4"
													placeholder="If you have any additional notes for the estimate you can add them here..."
													class="form-control"></textarea>
												<div class="label text-danger" id="notesAlert" style="display: none;">
													Add final notes! </div>
											</div>
										</div>
									</form>
								</div>
							</div>
							<div class="modal-footer">
								<div class="go_back_button">
									<a href="javascript:void(0)" class="gbtn gbtn_orange gbsp1" data-dismiss="modal"
										data-target="#singlePaymentSt1" data-toggle="modal">Go Back</a>
								</div>
								<div class="modal_actions">
									<ul>
										<li><a href="javascript:void(0)" class="gbtn gbtn_bdr cancelBtn"
												data-dismiss="modal">Cancel</a></li>
										<li><a href="javascript:void(0)" class="gbtn continue" id="offerSend1">Send
												Offer</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--===== Markup For "Single Payment Modal" Ends Here =====-->


				<!--===== Markup For "Milestone Payment Modal" Starts From Here =====-->
				<div class="modal fade create_offer_modal payment_method_modal" data-backdrop="static"
					id="milestonePaymentSt1">
					<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header">
								<h3>Create Milestone Offers</h3>
								<button type="button" class="close cancelBtn" data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body">
								<div class="creating_offer">
									<form action="">
										<div class="title">
											<h4 id="mp1title">Service Name/Service Title</h4>
										</div>
										<div class="proposal_wrap">
											<div class="service_image pay1">
												<img src="" class="img-fluid" alt="" />
											</div>
											<div class="describe_offer">
												<textarea name="" class="form-control" id="mp1desc" cols="30" rows="4"
													placeholder="Describe Your System..."></textarea>
											</div>
										</div>
										<div class="label text-danger" id="derrormp1" style="display: none;"> Provide a
											description! </div>
										<div class="set_offer_wrap">
											<div class="title">
												<h4>Set Up Offer</h4>
											</div>
											<div class="offer_box set_milestones">
												<div class="single_field">
													<label for="">QTY</label>
													<div class="input_icon">
														<select name="" id="mp1qty" class="form-control">
															<option value="1">1</option>
															<option value="2">2</option>
															<option value="3">3</option>
															<option value="4">4</option>
															<option value="5">5</option>
															<option value="6">6</option>
															<option value="7">7</option>
															<option value="8">8</option>
															<option value="9">9</option>
															<option value="10">10</option>
														</select>
														<i class="fas fa-sort-amount-up-alt"></i>
													</div>
												</div>
												<div class="single_field">
													<label for="">Delivery <a href="javascript:void(0)"
															title="The order duration might change depending on the back and forth communications between buyer and seller."
															data-toggle="tooltip"><i class="fa fa-question-circle"
																aria-hidden="true"></i></a></label>
													<div class="input_icon">
														<select name="" id="mp1delivery" class="form-control">
															<option value="1" selected>1 Day</option>
															<option value="2">2 Days</option>
															<option value="3">3 Days</option>
															<option value="4">4 Days</option>
															<option value="5">5 Days</option>
															<option value="6">6 Days</option>
															<option value="7">1 Week</option>
															<option value="14">2 Weeks</option>
															<option value="21">3 Weeks</option>
															<option value="30">1 Month (30 Days)</option>
															<option value="60">2 Months (60 Days)</option>
															<option value="90">3 Months (90 Days)</option>
														</select>
														<i class="far fa-clock"></i>
													</div>
												</div>
												<div class="single_field">
													<label for="">Unit Price</label>
													<div class="input_icon">
														<input type="number" id="mp1up" class="form-control"
															placeholder="25,000 Max" />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
												<div class="single_field">
													<label for="">Total</label>
													<div class="input_icon">
														<input type="number" id="mp1tot" class="form-control"
															placeholder="1,00,000 Max" />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-sm-1"></div>
												<div class="col-sm-2 label text-danger" style="display: none;"
													id="qerrormp1"> Add Quantity! </div>
												<div class="col-sm-2"></div>
												<div class="col-sm-2 label text-danger text-right"
													style="display: none;" id="uperrormp1"> Add Unit Price! </div>
												<div class="col-sm-2"></div>
												<div class="col-sm-2 label text-danger text-right"
													style="display: none;" id="dayerrormp1"> Add Days! </div>
											</div>
											<div class="created_milestones" id="totalMilestones"></div>
											<div class="add_create_btns">
												<ul>
													<li><a href="javascript:void(0)" id="mp1cn"
															class="gbtn gbtn_bdr">Create New Milestone</a></li>
													<li><a href="javascript:void(0)" id="mp1add" class="gbtn"><i
																class="fas fa-plus"></i> Add</a></li>
												</ul>
											</div>
										</div>
									</form>
									<div class="label text-danger" id="mp1_emp" style="display: none;"> Add at least one
										milestone! </div>
								</div>
							</div>
							<div class="modal-footer">
								<div class="go_back_button">
									<a href="javascript:void(0)" class="gbtn gbtn_orange gbpay" data-dismiss="modal"
										data-target="#singleMilestones" data-toggle="modal">Go Back</a>
								</div>
								<div class="modal_actions">
									<ul>
										<li><a href="javascript:void(0)" class="gbtn gbtn_bdr cancelBtn"
												data-dismiss="modal">Cancel</a></li>
										<li><a href="javascript:void(0)" data-dismiss="modal" data-toggle="modal"
												class="gbtn continue" id="mp1Con">Continue</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal fade create_offer_modal payment_method_modal" data-backdrop="static"
					id="milestonePaymentSt2">
					<div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header">
								<h3>Milestone Payment Final Details</h3>
								<button type="button" class="close cancelBtn" data-dismiss="modal">&times;</button>
							</div>
							<div class="modal-body">
								<div class="creating_offer">
									<form action="">
										<div class="final_offer">
											<div class="title">
												<h4>Offer Final Details</h4>
											</div>
											<div class="offer_box delivery_revisions">
												<div class="single_field delivery_field">
													<div class="label_wrap">
														<label for="">Delivery <a href="javascript:void(0)"
																title="The order duration might change depending on the back and forth communications between buyer and seller."
																data-toggle="tooltip"><i class="fa fa-question-circle"
																	aria-hidden="true"></i></a></label>
													</div>
													<div class="input_icon">
														<select name="" id="finaldelivery" class="form-control">
															<option value="1">1 Day</option>
															<option value="2">2 Days</option>
															<option value="3">3 Days</option>
															<option value="4">4 Days</option>
															<option value="5">5 Days</option>
															<option value="6">6 Days</option>
															<option value="7">7 Days</option>
															<option value="8">8 Days</option>
															<option value="9">9 Days</option>
															<option value="10">10 Days</option>
															<option value="11">11 Days</option>
															<option value="12">12 Days</option>
															<option value="13">13 Days</option>
															<option value="14">14 Days</option>
															<option value="15">15 Days</option>
															<option value="16">16 Days</option>
															<option value="17">17 Days</option>
															<option value="18">18 Days</option>
															<option value="19">19 Days</option>
															<option value="20">20 Days</option>
														</select>
														<i class="far fa-clock"></i>
													</div>
												</div>
												<div class="single_field">
													<div class="label_wrap">
														<label for="">Revisions <span>(Optional)</span></label>
													</div>
													<div class="input_icon">
														<select name="" id="finalrevision" class="form-control">
															<option value="0">0</option>
															<option value="1">1</option>
															<option value="2">2</option>
															<option value="3">3</option>
															<option value="4">4</option>
															<option value="5">5</option>
															<option value="6">6</option>
															<option value="7">7</option>
															<option value="8">8</option>
															<option value="9">9</option>
															<option value="10">10</option>
														</select>
														<i class="fas fa-sync-alt"></i>
													</div>
												</div>
											</div>
											<div class="offer_box pricing_details">
												<div class="single_field">
													<label for="">Sub-Total</label>
													<div class="input_icon">
														<input type="text" id="finalsubtot" class="form-control"
															placeholder="" readonly />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
												<div class="single_field">
													<label for="">Discount</label>
													<div class="input_icon">
														<input type="number" id="finaldiscount" class="form-control"
															placeholder="" />
														<i class="fas fa-dollar-sign"></i>
													</div>
													<div class="label text-danger" id="discAlert"
														style="display: none;"> Please add discount. </div>
												</div>
												<div class="single_field">
													<label for="">Gabazzo Rate</label>
													<input type="text" class="form-control" disabled value="5%"
														placeholder="" />
												</div>
												<div class="single_field">
													<label for="">Quote Total</label>
													<div class="input_icon">
														<input type="text" id="finalquote" class="form-control"
															placeholder="" value="3,193" readonly />
														<i class="fas fa-dollar-sign"></i>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-sm-2 labael text-danger" id="highdis2"
													style="display: none;"> Discount too high! </div>
											</div>
											<div class="notes">
												<div class="title">
													<h4>Notes</h4>
												</div>
												<textarea name="" id="mpfinalnotes" cols="30" rows="4"
													placeholder="If you have any additional notes for the estimate you can add them here..."
													class="form-control"></textarea>
											</div>
											<div class="label text-danger" id="mpfnoteAlert" style="display: none;">
												Please add final notes. </div>
										</div>
									</form>
								</div>
							</div>
							<div class="modal-footer">
								<div class="go_back_button">
									<a href="javascript:void(0)" class="gbtn gbtn_orange gbsp1" data-dismiss="modal"
										data-target="#milestonePaymentSt1" data-toggle="modal">Go Back</a>
								</div>
								<div class="modal_actions">
									<ul>
										<li><a href="javascript:void(0)" class="gbtn gbtn_bdr cancelBtn"
												data-dismiss="modal">Cancel</a></li>
										<li><a href="javascript:void(0)" class="gbtn continue" id="offerSend2">Send
												Offer</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--===== Markup For "Milestone Payment Modal" Ends Here =====-->
				<!--===== Markup For "Order History" Starts From Here =====-->
				<!--===== Markup For "Order History" Ends Here =====-->
				<!--===== Markup For "Saved to List" Starts From Here =====-->
				<div class="modal fade creating_list_modal" id="addLabel">
					<div class="modal-dialog modal-md modal-dialog-centered">
						<div class="modal-content">
							<div class="modal-header">
								<h4>Name Your New Label</h4>
								<a href="javascript:void(0)" class="close" data-dismiss="modal">&times;</a>
							</div>
							<div class="modal-body">
								<form action="/add-label" method="POST">
									<div class="form-group">
										<input name="title" type="text" placeholder="Label Name" class="form-control">
									</div>
									<div class="submit_button">
										<button class="btn gbtn" type="submit">Create Label</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
				<!--===== Markup For "Saved to List" Ends Here =====-->
				<!-- Socket.io -->
				<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
				<!--jQuery Main Libraty Latest Version-->
				<script type="text/javascript" src="../js/jquery-3.5.1.min.js"></script>
				<!--Bootstrap v4.5.3 JS File-->
				<script type="text/javascript" src="../js/popper.min.js"></script>
				<script type="text/javascript" src="../js/bootstrap.min.js"></script>
				<!--Custom Script JS File-->
				<script type="text/javascript" src="../js/updatedCustom.js"></script>
				<script
					src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.31.0/js/vendor/jquery.ui.widget.js"></script>
				<script
					src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.31.0/js/jquery.iframe-transport.js"></script>
				<script
					src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.31.0/js/jquery.fileupload.js"></script>
				<script
					src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-jquery-file-upload/2.11.4/cloudinary-jquery-file-upload.js"></script>
				<script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
				
				<!--Custom JavaScript-->
				<script>
					$(document).ready(function () {

						const url = window.location.href.split('/')[2];

						$("#billingInformationModal").text(`Please click here at www.${url}.com/company-settings/userbilling to update your Billing Information before a work order gets started`)
						$("#cpytoclipboard").click(function(){
							navigator.clipboard.writeText(`Please click here at www.${url}.com/company-settings/userbilling to update your Billing Information before a work order gets started`)
						})

						//Setting the "active" class on contact list
						$(".addactive").closest('li').addClass('active');
						//Search Result Wrap
						//$(".search_results_wrap").hide();
						$(".single_result").hide();
						$("#file_success").show();
					});
					// Controls Chat Layout For Mobile
					$(document).ready(function () {
						$('.view_activity_link').click(function () {
							$('.gb_chat .gb_info').addClass('show');
						});
						$('.close_gb_info_link').click(function () {
							$('.gb_chat .gb_info').removeClass('show');
						});
					});
				</script>
				<script>
					var element = function (id) {
						return document.getElementById(id);
					}
					function scrollToBottom() {
						let msg = element("chat-message");
						$("div.msg_flow").scrollTop(msg.scrollHeight)
					}
					window.onload = scrollToBottom();
				</script>
				<script>
					$(document).ready(function () {
						var paymentmethod = '', serviceID = '', serviceImage = '', selectedService = '', counter = 1, isAdd = false, subtotal = 0, discount = 0, totalPrice = 0, revision = 0, totalDuration = 0, finalNotes = '';
						var spquantity = 0, spunitprice = 0, sptotal = 0, spdesc = '', countls = 0;
						var mpquantity = 0, mpunitprice = 0, mptotal = 0, mpdesc = '', mpdays = 0, countms = 0;
						var userBillingIndex = false, tax = 0;

						var payload = [];
						// Numeric only control handler
						jQuery.fn.ForceNumericOnly =
							function () {
								return this.each(function () {
									$(this).keydown(function (e) {
										var key = e.charCode || e.keyCode || 0;
										// allow backspace, tab, delete, enter, arrows, numbers and keypad numbers ONLY
										// home, end, period, and numpad decimal
										return (
											key == 8 ||
											key == 9 ||
											key == 13 ||
											key == 46 ||
											key == 110 ||
											key == 190 ||
											(key >= 35 && key <= 40) ||
											(key >= 48 && key <= 57) ||
											(key >= 96 && key <= 105));
									});
								});
							};
						$("input[type='number'").ForceNumericOnly();
						function succeeded(data) {
							if (data) {
								$("#status").empty();
								$("#status").append("Successfully uploaded file!");
							}
						}

						$("#addressmodalbtn").click(function(){
							if(userBillingIndex){
								$("#deliveryToAddress").modal('hide')
								$("#singleMilestones").modal('show')
							}
						})

						// Getting the user billing index number
						$(".userbilling").click(function(){
							userBillingIndex = $(this).attr('id');
						});

						//---------------------------------------------------------//
						//////Messaging Functionality//////
						var element = function (id) {
							return document.getElementById(id);
						}
						// Get Elements
						var status = element('status');
						var messages = element('chat-message');
						var textarea = element('textarea');
						// Set default status
						var statusDefault = status.textContent;
						var setStatus = function (s) {
							// Set status
							status.textContent = s;
							if (s !== statusDefault) {
								var delay = setTimeout(function () {
									setStatus(statusDefault);
								}, 4000);
							}
						}
						// Connect to socket.io
						var socket = io.connect();
						socket.on("connect_error", (err) => {
							console.log(`connect_error due to ${err.message}`);
						});
						socket.on("connect", () => {
							console.log(socket.connected); // true
						});
						socket.on("disconnect", () => {
							console.log(socket.connected); // false
						});
						if (socket !== undefined) {
							let fileURL = [];
							var myWidget = cloudinary.createUploadWidget({
								cloudName: 'gabazzo',
								uploadPreset: 'message_attachments'
							}, (error, result) => {
								if (!error && result && result.event === "success") {
									console.log('Done! Here is the info: ', result.info);
									let fileName = result.info.original_filename + '.' + result.info.secure_url.split('.')[result.info.secure_url.split('.').length - 1];
									fileURL.push({ url: result.info.secure_url, type: result.info.format, name: fileName });
									succeeded(true);
								}
								if (error) {
									console.log(error);
								}
								console.log(fileURL)
							}
							)
							document.getElementById("upload_widget").addEventListener("click", function () {
								myWidget.open();
							}, false);
							// Get Status From Server
							socket.on('status', function (data) {
								// get message status
								setStatus((typeof data === 'object') ? data.message : data);
								// If status is clear, clear text
								if (data.clear) {
									textarea.value = '';
								}
							});
							// Handle Input
							textarea.addEventListener('keydown', async function (event) {
								if (event.which === 13 && event.shiftKey == false) {
									// Emit to server input
									await socket.emit('input', {
										attachment: fileURL,
										message: textarea.value
									});
									textarea.value = '';
									fileURL = [];
									event.preventDefault();
								}
							});
							$("#chat-message").ready(function () {
								$(".btnWithdraw").on('click', async function () {
									let html = '<ul><li style="font-family: fangsong;" class="label text-black"> <b> Offer Withdrawn</b>  </li></ul>'
									let x = $(this).attr("id");
									socket.emit('withdrawOffer', x);
									$(this).parent().parent().empty().html(html);
									//scrollToBottom();
								});
								$(".btnAcp").on('click', async function () {
									let html = '<ul><li style="font-family: fangsong;" class="label text-success"> <b> Offer Accepted </b>  </li></ul>'
									let x = $(this).attr("id").substr(6);
									socket.emit('acceptDeclineOffer', { status: 'accepted', id: x });
									$(this).parent().parent().empty().html(html);
								});
								$(".btnDec").on('click', async function () {
									let html = '<ul><li style="font-family: fangsong;" class="label text-danger"> <b> Offer Declined </b>  </li></ul>'
									let x = $(this).attr("id").substr(7);
									socket.emit('acceptDeclineOffer', { status: 'declined', id: x });
									$(this).parent().parent().empty().html(html);
								});
							});
							socket.on('withdrawOfferSuccess', async function (data) {
								console.log("withdrawOfferSuccess", data)
								$("#repButtons" + data).html('<li style="font-family: fangsong;" class="label text-black"> <b> Offer Withdrawn</b>  </li>');
								$("#wd" + data).replaceWith('<li style="font-family: fangsong;" class="label text-black"> <b> Offer Withdrawn</b>  </li>');
							});
							socket.on('acceptDeclineSuccess', async function (obj) {
								console.log("acceptDeclineSuccess", obj)
								if (obj.status === 'accepted') {
									//Removing the accept-decline buttons - buyer view
									$("#repButtons" + obj.id).html('<li style="font-family: fangsong;" class="label text-success"> <b> Offer Accepted</b>  </li>')
									//Removing the withdrawn button - seller view
									$("#wd" + obj.id).replaceWith('<li style="font-family: fangsong;" class="label text-success"> <b> Offer Accepted</b>  </li>')
									if(!clientCurrentUser){
										location.replace(`/order-details-single-payment-page/${obj.id}`);
									}
								}
								else if (obj.status === 'declined') {
									//Removing the accept-decline buttons - buyer view
									$("#repButtons" + obj.id).html('<li style="font-family: fangsong;" class="label text-danger"> <b> Offer Declined</b>  </li>')
									//Removing the withdrawn button - seller view
									$("#wd" + obj.id).replaceWith('<li style="font-family: fangsong;" class="label text-danger"> <b> Offer Declined</b>  </li>')
								}
							});
							// Handle Output
							socket.on('output', async function (data) {
								if (data.length) {
									if (window.location.href.includes(data[0].from.id) || window.location.href.includes(data[0].to.id)) {
										console.log("Current Chat opened on both the users");
										for (var x = 0; x < data.length; x++) {
											if (data[x].message != undefined || data[x].attachments != undefined) {
												let html = '';
												if (window.location.href.includes(data[0].receiverID)) {
													html += '<div class="msg_wrap sent_msg_wrap"><div class="profile_link_image">';
												}
												else {
													html += '<div class="msg_wrap received_msg_wrap"><div class="profile_link_image">';
												}
												if (data[x].from.isCompany) {
													if (data[x].from.logo) {
														//Appending the image part
														html = html + '<a href="javascript:void(0)"><img src="' + data[x].from.logo + '" alt="profilePicture" /></a></div>'
													}
													else {
														//Appending the image part
														html = html + '<a href="javascript:void(0)"><img src="../images/man.png" alt="profilePicture" /></a></div>'
													}
												}
												else {
													if (data[x].from.profilePicture) {
														//Appending the image part
														html = html + '<a href="javascript:void(0)"><img src="' + data[x].from.profilePicture + '" alt="profilePicture" /></a></div>'
													}
													else {
														//Appending the image part
														html = html + '<a href="javascript:void(0)"><img src="../images/man.png" alt="profilePicture" /></a></div>'
													}
												}
												//custom offer
												if (data[x].offer) {
													let counter = 0;
													if (data[x].offer.type === 'singlepayment') {
														html = html + '<div class="msg_body"><div class="sent_offer"><div class="indicator_texts"><h4><time>' + data[x].timeAgo + '|</time> Sent Custom Offer <a href="javascript:void(0)" title="' + data[x].offer.service.title + '" data-toggle="tooltip" data-placement="left"><i class="fas fa-info-circle"></i></a></h4></div><div class="offer_box_wrap"><div class="payment_type"><h4>Single Payment Offer</h4></div><div class="sent_offer_box"><div class="all_milestones" id="allMilestone">'
														for (let i = 0; i < data[x].offer.tasks.length; i++) {
															counter = i + 1;
															html = html + '<div class="single_item"><div class="click_item"><a href="javascript:void(0)" data-target="#milestask' + data[x].offer.id + counter + '" class="collapsed" data-toggle="collapse"><div class="milestone_name_price"><div class="milestone_name"><h4>Description #' + counter + '</h4></div><div class="milestone_price"><h4>$' + data[x].offer.tasks[i].totalPrice + '</h4></div></div></a></div><div id="milestask' + data[x].offer.id + counter + '" class="collapse fade contents" data-parent="#allMilestone"><div class="title"><h4>' + data[x].offer.service.title + '</h4></div><div class="service_img_descrip"><div class="service_image"><img src="' + data[x].offer.service.image + '" class="img-fluid" alt="" /></div><div class="service_descrip"><p>' + data[x].offer.tasks[i].description + '</p><div class="offer_facts milestone_facts"><div class="single_fact"><h6>QTY</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.tasks[i].quantity + '</h5><i class="fas fa-sort-amount-up-alt"></i></div></div><div class="single_fact"><h6>Unit Price</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.tasks[i].unitPrice + '</h5><i class="fas fa-dollar-sign"></i></div></div><div class="single_fact"><h6>Total</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.tasks[i].totalPrice + '</h5><i class="fas fa-dollar-sign"></i></div></div></div></div></div></div></div>';
														}
														html = html + '<div class="offer_facts total_facts"><div class="single_fact"><h6>Sub Total</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.subTotal + '</h5><i class="fas fa-dollar-sign"></i></div></div><div class="single_fact"><h6>Delivery</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.totalDuration + '</h5><i class="far fa-clock"></i></div></div><div class="single_fact"><h6>Gabazzo Fee</h6><div class="tiny_box"><h5>5%</h5></div></div><div class="single_fact"><h6>Revisions</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.revision + '</h5><i class="fas fa-sync-alt"></i></div></div><div class="single_fact"><h6>Quote Total</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.totalCost + '</h5><i class="fas fa-dollar-sign"></i></div></div></div></div>';
													}
													else {
														html = html + '<div class="msg_body"><div class="sent_offer"><div class="indicator_texts"><h4><time>' + data[x].timeAgo + '|</time> Sent Custom Offer <a href="javascript:void(0)" title="' + data[x].offer.service.title + '" data-toggle="tooltip" data-placement="left"><i class="fas fa-info-circle"></i></a></h4></div><div class="offer_box_wrap"><div class="payment_type"><h4>Milestone Payment Offer</h4></div><div class="sent_offer_box"><div class="all_milestones" id="allMilestone">'
														for (let i = 0; i < data[x].offer.tasks.length; i++) {
															counter = i + 1;
															html = html + '<div class="single_item"><div class="click_item"><a href="javascript:void(0)" data-target="#milestask' + data[x].offer.id + counter + '" class="collapsed" data-toggle="collapse"><div class="milestone_name_price"><div class="milestone_name"><h4>Milestone #' + counter + '</h4></div><div class="milestone_price"><h4>$' + data[x].offer.tasks[i].totalPrice + '</h4></div></div></a></div><div id="milestask' + data[x].offer.id + counter + '" class="collapse fade contents" data-parent="#allMilestone"><div class="sent_offer_box"><div class="title"><h4>' + data[x].offer.service.title + '</h4></div><div class="service_img_descrip"><div class="service_image"><img src="' + data[x].offer.service.image + '" class="img-fluid" alt="" /></div><div class="service_descrip"><p>' + data[x].offer.tasks[i].description + '</p><div class="offer_facts milestone_facts"><div class="single_fact"><h6>QTY</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.tasks[i].quantity + '</h5><i class="fas fa-sort-amount-up-alt"></i></div></div><div class="single_fact"><h6>Delivery</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.tasks[i].delivery + ' Days</h5><i class="far fa-clock"></i></div></div><div class="single_fact"><h6>Unit Price</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.tasks[i].unitPrice + '</h5><i class="fas fa-dollar-sign"></i></div></div><div class="single_fact"><h6>Total</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.tasks[i].totalPrice + '</h5><i class="fas fa-dollar-sign"></i></div></div></div></div></div></div></div>';
														}
														html = html + '<div class="offer_facts total_facts"><div class="single_fact"><h6>Sub Total</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.subTotal + '</h5><i class="fas fa-dollar-sign"></i></div></div><div class="single_fact"><h6>Delivery</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.totalDuration + '</h5><i class="far fa-clock"></i></div></div><div class="single_fact"><h6>Gabazzo Fee</h6><div class="tiny_box"><h5>5%</h5></div></div><div class="single_fact"><h6>Revisions</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.revision + '</h5><i class="fas fa-sync-alt"></i></div></div><div class="single_fact"><h6>Quote Total</h6><div class="tiny_box tiny_box_usd"><h5>' + data[x].offer.totalCost + '</h5><i class="fas fa-dollar-sign"></i></div></div></div></div>';
													}
													// SENDER VIEW - APPENDING THE BTNS
													if (window.location.href.includes(data[0].receiverID)) {
														html += '<div class="offer_buttons"><div class="left_buttons"><ul><li><a href="https://s3.amazonaws.com/assets.gabazzo.com/' + data[0].offer.id + '.pdf" target="_blank" class="gbtn gbtn_orange_bdr">View PDF File</a></li></ul></div><div class="right_buttons"><ul><ul><li id="wd' + data[0].offer.id + '"><button id="' + data[0].offer.id + '" class="btn gbtn gbtn_bdr btnWithdraw">Withdraw Offer</button></li></ul></ul></div></div>';
														$("body").on('click', '.btnWithdraw', async function () {
															let x = $(this).attr("id");
															socket.emit('withdrawOffer', x);
														});
													}
													// RECV VIEW - APPENDING THE BTNS
													else {
														html += '<div class="offer_buttons"><div class="left_buttons"><ul><li><a href="https://s3.amazonaws.com/assets.gabazzo.com/' + data[0].offer.id + '.pdf" target="_blank" class="gbtn gbtn_orange_bdr">View PDF File</a></li></ul></div><div class="right_buttons"><ul><ul id="repButtons' + data[0].offer.id + '"><li><button id="decline' + data[0].offer.id + '" type="submit" class="btn gbtn gbtn_bdr btnDec">Decline Offer</button></li><li><button id="accept' + data[0].offer.id + '" type="submit" class="btn gbtn btnAcp">Accept Offer</button></li></ul></ul></div></div>';
														$("body").on('click', '.btnAcp', async function () {
															let x = $(this).attr("id").substr(6);
															socket.emit('acceptDeclineOffer', { status: 'accepted', id: x });
														});
														$("body").on('click', '.btnDec', async function () {
															let x = $(this).attr("id").substr(7);
															socket.emit('acceptDeclineOffer', { status: 'declined', id: x });
														});
													}
													html = html + '</div>';
												}
												else {
													//Appending Message and Time part
													if (window.location.href.includes(data[0].receiverID)) {
														html = html + '<div class="msg_content"><div class="msg_body"><p>' + data[x].message + '</p></div><div class="msg_time_actions"><div class="msg_time grid_item"><time>' + data[x].timeAgo + '</time></div></div>';
													}
													else {
														html = html + '<div class="msg_content"><div class="msg_body"><p>' + data[x].message + '</p></div><div class="msg_time_actions"><div class="msg_time grid_item"><time>' + data[x].timeAgo + '</time></div></div>';
													}
													if (data[x].attachments != undefined) {
														var fileAddr, tempfn, fileName;
														html = html + '<div class="msg_attachments_files">'
														for (let i = 0; i < data[x].attachments.length; i++) {
															fileAddr = data[x].attachments[i].url;
															tempfn = fileAddr.split("/");
															fileName = data[x].attachments[i]?.name;
															fileAddr.replace("/raw/upload", "/files");
															for (let i = 0; i < data[x].attachments.length; i++) {
																if (data[x].attachments[i].type === 'jpg' || data[x].attachments[i].type === 'jpeg' || data[x].attachments[i].type === 'png' || data[x].attachments[i].type === 'gif') {
																	if (window.location.href.includes(data[0].receiverID)) {
																		html = html + '<div class="msg_attachment_items" align="right"> <a href="' + data[x].attachments[i].url + '" rel="noopener noreferrer" target="_blank" download><img src="' + data[x].attachments[i].url + '" class="img-thumbnail" loading="lazy" width="400px" /></a></div>';
																	}
																	else {
																		html = html + '<div class="msg_attachment_items"> <a href="' + data[x].attachments[i].url + '" rel="noopener noreferrer" target="_blank" download><img src="' + data[x].attachments[i].url + '" class="img-thumbnail" loading="lazy" width="400px" /></a></div>';
																	}
																}
																else if (data[x].attachments[i].url.substr(data[x].attachments[i].url.length - 3) === 'doc' || data[x].attachments[i].url.substr(data[x].attachments[i].url.length - 4) === 'docx' || data[x].attachments[i].url.substr(data[x].attachments[i].url.length - 3) === 'odt' || data[x].attachments[i].url.substr(data[x].attachments[i].url.length - 3) === 'txt') {
																	if (window.location.href.includes(data[0].receiverID)) {
																		html = html + '<div class="msg_attachment_items" align="right"> <a href="' + fileAddr + '" class="file-links doc-link" target="_blank" download> ' + fileName + ' </a></div>';
																	}
																	else {
																		html = html + '<div class="msg_attachment_items"> <a href="' + fileAddr + '" class="file-links doc-link" target="_blank" download> ' + fileName + ' </a></div>';
																	}
																}
																else if (data[x].attachments[i].url.substr(data[x].attachments[i].url.length - 3) === 'pdf') {
																	if (window.location.href.includes(data[0].receiverID)) {
																		html = html + '<div class="msg_attachment_items" align="right"> <a href="' + fileAddr + '" class="file-links pdf-link" target="_blank" download> ' + fileName + ' </a></div>';
																	}
																	else {
																		html = html + '<div class="msg_attachment_items"> <a href="' + fileAddr + '" class="file-links pdf-link" target="_blank" download> ' + fileName + ' </a></div>';
																	}
																}
																else if (data[x].attachments[i].url.substr(data[x].attachments[i].url.length - 3) === 'pdf' || data[x].attachments[i].url.substr(data[x].attachments[i].url.length - 3) === 'rar') {
																	if (window.location.href.includes(data[0].receiverID)) {
																		html = html + '<div class="msg_attachment_items" align="right"> <a href="' + fileAddr + '" class="file-links rar-link" target="_blank" download> ' + fileName + ' </a></div>';
																	}
																	else {
																		html = html + '<div class="msg_attachment_items"> <a href="' + fileAddr + '" class="file-links rar-link" target="_blank" download> ' + fileName + ' </a></div>';
																	}
																}
																else if (data[x].attachments[i].type === 'mp4' || data[x].attachments[i].type === 'ogg' || data[x].attachments[i].type === 'webm' || data[x].attachments[i].type === 'mkv' || data[x].attachments[i].type === 'mov') {
																	if (window.location.href.includes(data[0].receiverID)) {
																		html = html + '<div class="msg_attachment_items align="right"" height="200px" width="160px"> <video width="50%" height="100%" controls><source src="' + data[x].attachments[i].url + '" type="video/mp4"><source src="' + data[x].attachments[i].url + '" type="video/ogg"></video></div>';
																	}
																	else {
																		html = html + '<div class="msg_attachment_items" height="200px" width="160px"> <video width="50%" height="100%" controls><source src="' + data[x].attachments[i].url + '" type="video/mp4"><source src="' + data[x].attachments[i].url + '" type="video/ogg"></video></div>';
																	}
																}
																else {
																	if (window.location.href.includes(data[0].receiverID)) {
																		html = html + '<div class="msg_attachment_items" align="right"> <a href="' + fileAddr + '" class="file-links other-link" target="_blank" download>' + fileName + ' </a></div>';
																	}
																	else {
																		html = html + '<div class="msg_attachment_items"> <a href="' + fileAddr + '" class="file-links other-link" target="_blank" download>' + fileName + ' </a></div>';
																	}
																}
															}
														}
														html = html + '</div>';
													}
												}
												html = html + '</div></div></div>'
												$("#chat-message").append(html);
												scrollToBottom();
											}
										}
										//Handling "THIRD" user messages
										let senderID = data[0].senderID, receiverID = data[0].receiverID;
										let isUserSender = false, conversationTag;
										//If the URL is same as of the id of Reciever - Conversation is opened (The window of the sender PC)
										// Current User
										if (window.location.href.includes(receiverID)) {
											let tempTag = $("#" + data[0].to.username).clone();
											$("#" + data[0].to.username).remove();
											$("#searchFilter").prepend(tempTag);
											let tag;
											if (data[0].to.isCompany)
												tag = '<div class="user_name" > <h6 style="text-transform: capitalize">' + data[0].to.companyName + '</h6> </div><p> <span> Me: </span>' + data[0].message + '<span class="badge badge-info" style="display: none;">New</span> </p>';
											//tag = '<h6 style="text-transform: capitalize;">' + data[0].from.companyName + '</h6><small class="last_message">' + data[0].message + '</small>';  
											else
												tag = '<div class="user_name"> <h6 style="text-transform: capitalize">' + data[0].to.firstName + ' ' + data[0].to.lastName + '</h6> </div><p> <span> Me: </span>' + data[0].message + '<span class="badge badge-info" style="display: none;">New</span> </p>';
											if (data[0].to.status)
												tag += '<time> <span>Online</span></time>';
											else
												tag += '<time> <span>' + data[0].timeAgo + '</span></time>'
											$("#" + receiverID).html(tag);
										}
										//If the Reciever has opened the conversation of the sender
										if (window.location.href.includes(senderID)) {
											let tempTag = $("#" + data[0].from.username).clone();
											$("#" + data[0].from.username).remove();
											$("#searchFilter").prepend(tempTag)
											let tag;
											if (data[0].from.isCompany)
												tag = '<div class="user_name"> <h6 style="text-transform: capitalize">' + data[0].from.companyName + '</h6> </div><p>' + data[0].message + '<span class="badge badge-info" style="margin-left: 5px">New</span> </p>';
											//tag = '<h6 style="text-transform: capitalize;">' + data[0].from.companyName + '</h6><small class="last_message">' + data[0].message + '</small>';  
											else
												tag = '<div class="user_name"> <h6 style="text-transform: capitalize">' + data[0].from.firstName + ' ' + data[0].from.lastName + '</h6> </div><p>' + data[0].message + '<span class="badge badge-info"  style="margin-left: 5px">New</span> </p>';
											if (data[0].from.status)
												tag += '<time> <span>Online</span></time>';
											else
												tag += '<time> <span>' + data[0].timeAgo + '</span></time>'
											$("#" + senderID).html(tag);
										}
									}
									else {
										let senderID = data[0].senderID, receiverID = data[0].receiverID;
										let isUserSender = false, conversationTag;
										console.log("This is called when some other user msgs and its conv does not exist", senderID, receiverID, window.location.href)
										if ($("#" + data[0].from.username).length === 0) {
											console.log("LENGTH IS ZERO")
											let tag = '<li id="' + data[0].from.username + '"> </li><a href="/inbox/' + data[0].from.id + '"> <div class="profile_pic"> '
											if (data[0].from.isCompany) {
												if (data[0].from.logo)
													tag = tag + '<img src="' + data[0].from.logo + '" alt="" />'
												else
													tag = tag + '<img src="../images/man.png" alt="" />'
												if (data[0].from.status)
													tag += '<span class="activity_status online_status"></span>';
												else
													tag += '<span class="activity_status offline_status"></span>';
												tag = tag + '</div><div id="' + data[0].from.id + '" class="profile_info"> <div class="user_name"> <h6>' + data[0].from.companyName + '</h6> </div><p> <span>' + data[0].from.companyName + ': </span>' + data[0].message + '<span class="badge badge-info">New</span> </p>';
												if (data[0].from.status)
													tag += '<time> <span>Online</span></time>';
												else
													tag += '<time> <span>' + data[0].timeAgo + '</span></time>';
												tag = tag + '</div> </a></li>';
											}
											else {
												if (data[0].from.profilePicture)
													tag = tag + '<img src="' + data[0].from.profilePicture + ' " alt="" />'
												else
													tag = tag + '<img src="../images/man.png" alt="" />'
												if (data[0].from.status)
													tag += '<span class="activity_status online_status"></span>';
												else
													tag += '<span class="activity_status offline_status"></span>';
												tag = tag + '</div><div id="' + data[0].from.id + '" class="profile_info"> <div class="user_name"> <h6>' + data[0].to.firstName + ' ' + data[0].to.lastName + '</h6> </div><p> <span>' + data[0].to.firstName + ': </span>' + data[0].message + '<span class="badge badge-info">New</span> </p>'
												if (data[0].from.status)
													tag += '<time> <span>Online</span></time>';
												else
													tag += '<time> <span>' + data[0].timeAgo + '</span></time>';
												tag = tag + '</div> </a></li>';
											}
											$("#searchFilter").prepend(tag);
										}
										else {
											console.log("LENGTH IS NOT ZERO")
											let tempTag = $("#" + data[0].from.username).clone();
											$("#" + data[0].from.username).remove();
											$("#searchFilter").prepend(tempTag)
											let tag = '<div class="user_name"> <h6>' + data[0].from.firstName + ' ' + data[0].from.lastName + '</h6> </div><p> <span>' + data[0].from.firstName + ': </span>' + data[0].message + '<span class="badge badge-info">New</span> </p>';
											$("#" + data[0].from.id).html(tag);
										}
									}
								}
							});
							window.onunload = async function () {
								await socket.emit("disconnected");
							};
							$("#sendMsgBtn").click(async function () {
								// Emit to server input
								await socket.emit('input', {
									attachment: fileURL,
									message: textarea.value,
								});
								$("#status").empty();
								fileURL = [];
								textarea.value = '';
								$(function () {
									$(".addactive").closest('li').addClass('active');
								});
								$("#fileList").load(location.href + " #fileList>*", "");
							});
							$(".sendQM").click(async function () {
								// Emit to server input
								let txt = $(this).closest(".single_quick_sms").children(".created_sms").children().text();
								await socket.emit('input', {
									attachment: fileURL,
									message: txt,
								});
								$("#status").empty();
								fileURL = [];
								textarea.value = '';
								$("#fileList").load(location.href + " #fileList>*", "");
							});
							$(".editQM").click(async function () {
								// Emit to server input
								let txt = $(this).closest(".single_quick_sms").children(".created_sms").children().text();
								$("#textarea").val(txt);
							});
						}
						//------------------------------------------------------------------------------//
						$("#modalOpen").on("click", function () {
							$("#serviceCon").unbind('click');
							$("#continuepay").unbind('click');
							$("#sp1Con").unbind('click');
							$("#offerSend1").unbind('click');
							$("#mp1Con").unbind('click');
							$("#offerSend2").unbind('click');
							$("#sp1add").unbind('click');
							$("#mp1add").unbind('click');
							$("#mp1cn").unbind('click');
						});
						//Cancel Button functionality for Modal
						$(document).on("click", ".cancelBtn", function () {
							paymentmethod = ''; serviceID = ''; serviceImage = ''; selectedService = ''; payload = []; counter = 1; isAdd = false; subtotal = 0; discount = 0; totalPrice = 0; revision = 0; totalDuration = 0; finalNotes = '';
							spquantity = 0; spunitprice = 0; sptotal = 0; spdesc = ''; countls = 0;
							mpquantity = 0; mpunitprice = 0; mptotal = 0; mpdesc = '', mpdays = 0, countms = 0;
							$("#sp1title").empty();
							$("#mp1title").empty();
							$(".set_offer_wrap .single_item").remove();
							$("#selectService_val").hide();
							$("#addrowerr").hide();
							$("#sp1do").val('');
							$("#sp1qty").val('');
							$("#sp1up").val('0');
							$("#sp1up").val('');
							$("#sp1tot").val('');
							$("#numDays").val('');
							$("#numRevisions").val('');
							$("#sp2discount").val('');
							$("#createdSingles").empty();
							$("#discountAlert").hide();
							$("#notesAlert").hide();
							$("#mp1_emp").hide();
							$("#mp1desc").val('');
							$("#mp1qty").val('');
							$("#mp1up").val('0');
							$("#mp1up").val('');
							$("#mp1tot").val('');
							$("#mp1delivery").val('0');
							$("#totalMilestones").empty();
							$("#discAlert").hide();
							$("#mpfnoteAlert").hide();
							$("#sp2notes").val('');
							$("#mpfinalnotes").val('');
							//Deselecting choices
							//Remove Ticks
							$("input[name='theService']").attr("checked", false);
							$("input[name='theService']").parent().removeClass('active');
							$("input[name='paymentSystem']").attr("checked", false);
							$("input[name='paymentSystem']").parent().removeClass('active');
							//Remove Values and Added Button Data
							$("#serviceCon").removeAttr("data-target", "#singleMilestones");
							$("#serviceCon").removeAttr("data-dismiss", "modal");
							$("#continuepay").removeAttr("data-dismiss", "modal");
							$("#continuepay").removeAttr("data-target", "#singlePaymentSt1");
							$("#continuepay").removeAttr("data-target", "#milestonePaymentSt1");
							$("#sp1Con").removeAttr("data-target", "#singlePaymentSt2");
							$("#sp1Con").removeAttr("data-dismiss", "modal");
							$("#mp1Con").removeAttr("data-target", "#milestonePaymentSt2");
							$("#mp1Con").removeAttr("data-dismiss", "modal");
						});
						//Service Select Modal
						$(".serviceSelect").on("click", function () {
							serviceID = '', selectedService = '', selectedService = '', serviceImage = '';
							serviceID = $(this).find(".service_title h4").attr("id");
							selectedService = $(this).find(".service_title h4").text();
							serviceImage = $(this).find(".service_image img").attr("src");
							$("#selectService_val").hide();
							$("#serviceCon").attr("data-target", "#deliveryToAddress");
							$("#serviceCon").attr("data-dismiss", "modal");
						});
						$("#serviceCon").on("click", function () {
							if (serviceID == '' || selectedService == '') {
								$("#selectService_val").show();
							}
						});
						//Payment Select Modal
						$(".paymentSelect li").on("click", function () {
							paymentmethod = '';
							if ($(this).attr("id") == "singleP") {
								//let singleP = '<ul><li><a href="javascript:void(0)" class="gbtn gbtn_bdr cancelBtn" data-dismiss="modal">Cancel</a></li><li><a href="javascript:void(0)" class="gbtn continue continuepay" data-dismiss="modal" data-target="#singlePaymentSt1" data-toggle="modal">Continue</a></li></ul>'
								paymentmethod = "singlepayment";
								//$("#singleMilestones .modal_continue_payment").html(singleP);
								$("#continuepay").attr("data-dismiss", "modal");
								$("#continuepay").attr("data-target", "#singlePaymentSt1");
								$("#sp1title").text('');
								$("#sp1title").text(selectedService);
							}
							else if ($(this).attr("id") == "multiP") {
								//let milesP = '<ul><li><a href="javascript:void(0)" class="gbtn gbtn_bdr" data-dismiss="modal">Cancel</a></li><li><a href="javascript:void(0)" class="gbtn continue continuepay" data-dismiss="modal" data-target="#milestonePaymentSt1" data-toggle="modal">Continue</a></li></ul>'
								paymentmethod = "milestonepayment";
								//$("#singleMilestones .modal_continue_payment").html(milesP);
								$("#continuepay").attr("data-dismiss", "modal");
								$("#continuepay").attr("data-target", "#milestonePaymentSt1");
								$("#mp1title").text('');
								$("#mp1title").text(selectedService);
							}
							//Continue After Payment Method Modal
							$("#continuepay").on("click", function () {
								$(".pay1 img").attr("src", "" + serviceImage);
							});
							//Single Payment//
							//Qty
							$("#sp1qty").on("change", function () {
								$("#qerrorsp1").hide();
								spquantity = 0;
								spquantity = $("#sp1qty").val();
								sptotal = spquantity * spunitprice;
								$("#sp1tot").val(sptotal);
							});
							//Unit Price
							$("#sp1up").on("input", function () {
								$("#uperrorsp1").hide();
								spunitprice = '';
								spunitprice = $("#sp1up").val();
								sptotal = spquantity * spunitprice;
								$("#sp1tot").val(sptotal);
							});
							//Description
							$("#sp1do").on('input', function () {
								$("#derrorsp1").hide();
								spdesc = '';
								spdesc = $("#sp1do").val();
							});
							//Add Single Row
							$("#sp1add").on("click", function () {
								if (spdesc == '' || spquantity == 0 || spunitprice == '') {
									if (spdesc == '') {
										$("#derrorsp1").show();
									}
									if (spquantity == 0) {
										$("#qerrorsp1").show();
									}
									if (spunitprice == '') {
										$("#uperrorsp1").show();
									}
								}
								else {
									$("#sp1_emp").attr("display", "none");
									$("#derrorsp1").attr("display", "none");
									$("#qerrorsp1").attr("display", "none");
									$("#uperrorsp1").attr("display", "none");
									countls++;
									var offerrow = '<div class="single_item"><div class="click_item"><a href="javascript:void(0)" data-target="#milestone' + countls + '" class="collapsed" data-toggle="collapse"><div class="milestone_name_price"><div class="milestone_name"><h4>Description # ' + countls + '</h4></div><div class="milestone_price"><h4>' + sptotal + '$</h4></div></div></a></div><div id="milestone' + countls + '" class="collapse fade contents" data-parent="#createdSingles"><div class="created_milestone_box"><div class="service_title"><h4>' + selectedService + '</h4></div><div class="service_img_descrip"><div class="service_image"><img src="' + serviceImage + '" class="img-fluid" alt="" /></div><div class="service_descrip"><form action=""><textarea name="" id="" cols="30" rows="4" class="form-control" readonly>' + spdesc + '</textarea></form></div></div><div class="offer_box set_milestones"><div class="single_field"><label for="">QTY</label><div class="input_icon"><input type="text" class="form-control" value="' + spquantity + '" readonly/><i class="fas fa-sort-amount-up-alt"></i></div></div><div class="single_field"><label for="">Unit Price</label><div class="input_icon"><input type="text" class="form-control" value="' + spunitprice + '" readonly/><i class="fas fa-dollar-sign"></i></div></div><div class="single_field"><label for="">Total</label><div class="input_icon"><input type="text" class="form-control" placeholder="1,00,000 Max" value="' + sptotal + '" readonly/><i class="fas fa-dollar-sign"></i></div></div></div></div></div></div>';
									$("#createdSingles").append(offerrow);
									payload.push({
										quantity: spquantity,
										unitPrice: Number(spunitprice).toFixed(2),
										totalPrice: Number(sptotal).toFixed(2),
										description: spdesc
									});
									subtotal += Number(sptotal);
									$("#sp1Con").attr("data-target", "#singlePaymentSt2");
									$("#sp1Con").attr("data-dismiss", "modal");
									$("#sp1do").val('');
									$("#sp1qty").val('');
									$("#sp1up").val('0');
									$("#sp1up").val('');
									$("#sp1tot").val('0');
									spquantity = 0, spunitprice = 0; sptotal = 0, spdesc = '';
								}
							});
							//Continue actions
							$("#sp1Con").on('click', function () {
								if (countls == 0) {
									$("#sp1_emp").show();
								}
								else {
									$("#sp2subtot").val(Number(subtotal));
								}
							});
							//Final Phase for Single Payment
							$("#numDays").on('change', function () {
								totalDuration = '';
								totalDuration = Number($("#numDays").val());
								if (!totalDuration == '') {
									$("#offerSend1").attr("data-dismiss", "modal");
									$("#offerSend1").prop("disabled", false);
								}
								else {
									$("#offerSend1").removeAttr("data-dismiss", "modal");
									$("#offerSend1").prop("disabled", true);
								}
							});
							$("#numRevisions").on('change', function () {
								revision = '';
								revision = Number($("#numRevisions").val());
							});

							$("#tax").change(function(){
								tax = $(this).val();
								let tempdiscount = Number($("#sp2discount").val());
								let amount = ((Number(subtotal) - Number(tempdiscount)) + ((Number(subtotal) - Number(tempdiscount)) * 0.05) + ((Number(subtotal) - Number(tempdiscount)) * Number(tax)/100 ) );
								if (subtotal > tax) {
									$("#sp2quote").val(amount.toFixed(2));
									discount = tempdiscount;
									totalPrice = amount.toFixed(2);
								}
							})

							$("#sp2discount").on('input', function () {
								$("#highdis1").hide();
								$("#discountAlert").hide();
								let tempdiscount = Number($("#sp2discount").val());
								console.log(subtotal)
								let amount = ((Number(subtotal) - Number(tempdiscount)) + ((Number(subtotal) - Number(tempdiscount)) * 0.05) + ((Number(subtotal) - Number(tempdiscount)) * Number(tax)/100 ));
								if (subtotal > tempdiscount) {
									$("#sp2quote").val(amount.toFixed(2));
									discount = tempdiscount;
									totalPrice = amount.toFixed(2);
								}
								else {
									$("#sp2quote").val("0");
									$("#highdis1").show();
									$("#offerSend1").removeAttr("data-dismiss", "modal");
									$("#offerSend1").prop("disabled", true);
								}
								if (!(discount == '' || discount == 0)) {
									$("#offerSend1").attr("data-dismiss", "modal");
									$("#offerSend1").prop("disabled", false);
								}
								else {
									$("#offerSend1").removeAttr("data-dismiss", "modal");
									$("#offerSend1").prop("disabled", true);
								}
							});
							$("#sp2notes").on('input', function () {
								finalNotes = $("#sp2notes").val();
							});
							//Milestone Payment//
							//Qty
							$("#mp1qty").on("change", function () {
								mpquantity = '';
								mpquantity = $("#mp1qty").val();
								mptotal = mpquantity * mpunitprice;
								$("#mp1tot").val(mptotal);
								$("#mp1_emp").hide();
								$("#qerrormp1").hide();
							});
							//Unit Price
							$("#mp1up").on("input", function () {
								mpunitprice = '';
								mpunitprice = $("#mp1up").val();
								mptotal = mpquantity * mpunitprice;
								$("#mp1tot").val(mptotal);
								$("#mp1_emp").hide();
								$("#uperrormp1").hide();
							});
							//Description
							$("#mp1desc").on('input', function () {
								mpdesc = '';
								mpdesc = $("#mp1desc").val();
								$("#mp1_emp").hide();
								$("#derrormp1").hide();
							});
							//Days
							$("#mp1delivery").on('input', function () {
								mpdays = $("#mp1delivery").val();
								$("#mp1_emp").hide();
								$("#daysmp1").text("");
								$("#dayerrormp1").hide();
							});
							//Add Milestone
							$("#mp1cn").on("click", function () {
								$("#totalMilestones").empty();
								$("#mp1desc").val('');
								$("#mp1qty").val('');
								$("#mp1up").val('0');
								$("#mp1up").val('');
								$("#mp1delivery").val('');
								$("#mp1tot").val('');
								$("#mp1_emp").hide();
								$("#qerrormp1").hide();
								$("#uperrormp1").hide();
								$("#derrormp1").hide();
								$("#dayerrormp1").hide();
								mpquantity = 0; mpunitprice = 0; mptotal = 0; mpdesc = '', mpdays = 0, countls = 0;
							});
							//Add Service
							$("#mp1add").on("click", function () {
								if (mpdesc == '' || mpquantity == 0 || mpunitprice == '' || mpdays == '' || mpdays == 0) {
									if (mpdesc == '') {
										$("#derrormp1").show();
									}
									if (mpquantity == 0) {
										$("#qerrormp1").show();
									}
									if (mpunitprice == '') {
										$("#uperrormp1").show();
									}
									if (mpdays == 0) {
										$("#dayerrormp1").show();
									}
								}
								else {
									$("#mp1_emp").attr("display", "none");
									$("#derrormp1").attr("display", "none");
									$("#qerrormp1").attr("display", "none");
									$("#uperrormp1").attr("display", "none");
									$("#dayerrormp1").attr("display", "none");
									countls++;
									var offermp = '<div class="single_item"><div class="click_item"><a href="javascript:void(0)" data-target="#milestone' + countls + '" class="collapsed" data-toggle="collapse"><div class="milestone_name_price"><div class="milestone_name"><h4>Milestone # ' + countls + '</h4></div><div class="milestone_price"><h4>' + mptotal + '$</h4></div></div></a></div><div id="milestone' + countls + '" class="collapse fade contents" data-parent="#createdSingles"><div class="created_milestone_box"><div class="service_title"><h4>' + selectedService + '</h4></div><div class="service_img_descrip"><div class="service_image"><img src="' + serviceImage + '" class="img-fluid" alt="" /></div><div class="service_descrip"><form action=""><textarea name="" id="" cols="30" rows="4" class="form-control" readonly>' + mpdesc + '</textarea></form></div></div><div class="offer_box set_milestones"><div class="single_field"><label for="">QTY</label><div class="input_icon"><input type="text" class="form-control" value="' + mpquantity + '" readonly/><i class="fas fa-sort-amount-up-alt"></i></div></div><div class="single_field"><label for="">Unit Price</label><div class="input_icon"><input type="text" class="form-control" value="' + mpunitprice + '" readonly/><i class="fas fa-dollar-sign"></i></div></div><div class="single_field"><label for="">Unit Price</label><div class="input_icon"><input type="text" class="form-control" value="' + mpdays + ' Days" readonly/><i class="far fa-clock"></i></div></div><div class="single_field"><label for="">Total</label><div class="input_icon"><input type="text" class="form-control" placeholder="1,00,000 Max" value="' + mptotal + '" readonly/><i class="fas fa-dollar-sign"></i></div></div></div></div></div></div>';
									$("#totalMilestones").append(offermp);
									payload.push({
										quantity: mpquantity,
										delivery: mpdays,
										unitPrice: Number(mpunitprice).toFixed(2),
										totalPrice: Number(mptotal).toFixed(2),
										description: mpdesc
									});
									subtotal += Number(mptotal);
									totalDuration += Number(mpdays);
									$("#finaldelivery").val(totalDuration);
									$("#finalsubtot").val(subtotal);
									$("#mp1Con").attr("data-target", "#milestonePaymentSt2");
									$("#mp1Con").attr("data-dismiss", "modal");
									$("#mp1desc").val('');
									$("#mp1qty").val('');
									$("#mp1up").val('0');
									$("#mp1up").val('');
									$("#mp1tot").val('0');
									$("#mp1delivery").val('');
									mpquantity = 0; mpunitprice = 0; mptotal = 0; mpdesc = '', mpdays = 0;
								}
							});
							//Final Phase for Milestone Payment
							$("#finaldelivery").on('change', function () {
								totalDuration = '';
								totalDuration = Number($("#finaldelivery").val());
								if (!totalDuration == '') {
									$("#offerSend2").attr("data-dismiss", "modal");
									$("#offerSend2").prop("disabled", false);
								}
								else {
									$("#offerSend2").removeAttr("data-dismiss", "modal");
									$("#offerSend2").prop("disabled", true);
								}
							});
							$("#finalrevision").on('change', function () {
								revision = '';
								revision = Number($("#finalrevision").val());
							});

							
							$("#tax").change(function(){
								tax = $(this).val();
								let tempdiscount = Number($("#sp2discount").val());
								let amount = ((Number(subtotal) - Number(tempdiscount)) + ((Number(subtotal) - Number(tempdiscount)) * 0.05) + ((Number(subtotal) - Number(tempdiscount)) * Number(tax)/100 ) );
								if (subtotal > tax) {
									$("#sp2quote").val(amount.toFixed(2));
									discount = tempdiscount;
									totalPrice = amount.toFixed(2);
								}
							})

							$("#finaldiscount").on('input', function () {
								$("#highdis2").hide();
								//discount = Number($("#sp2discount").val());
								let tempdiscount = Number($("#finaldiscount").val());
								let amount = ((Number(subtotal) - Number(tempdiscount)) + ((Number(subtotal) - Number(tempdiscount)) * 0.05) + + ((Number(subtotal) - Number(tempdiscount)) * Number(tax)/100 ));
								if (subtotal > tempdiscount) {
									$("#finalquote").val(amount.toFixed(2));
									discount = tempdiscount;
									totalPrice = amount.toFixed(2);
								}
								else {
									$("#finalquote").val("0");
									$("#highdis2").show();
									$("#offerSend2").removeAttr("data-dismiss", "modal");
									$("#offerSend2").prop("disabled", true);
								}
								if (!(discount == '' || discount == 0)) {
									$("#offerSend2").attr("data-dismiss", "modal");
									$("#offerSend2").prop("disabled", false);
								}
								else {
									$("#offerSend2").removeAttr("data-dismiss", "modal");
									$("#offerSend2").prop("disabled", true);
								}
							});
							$("#mpfinalnotes").on('input', function () {
								finalNotes = $("#mpfinalnotes").val();
							});
							//----------------------------------------------------------------------------------------//
							//Custom Offer Send Part//
							//Single Payment
							$("#offerSend1").on('click', async function () {
								if (discount == 0 || finalNotes == '') {
									if (discount == 0) {
										$("#discountAlert").show();
									}
									if (finalNotes == '') {
										$("#notesAlert").show();
									}
								}
								else {
									await socket.emit('sendOffer', {
										offer: {
											paymentType: paymentmethod,
											service: serviceID,
											tasks: payload,
											subTotal: subtotal.toFixed(2),
											revision,
											totalPrice: Number(totalPrice).toFixed(2),
											totalDuration,
											discount,
											finalNotes,
											userBillingIndex,
											tax: Number(tax).toFixed(2)
										}
									});
									paymentmethod = ''; serviceID = ''; serviceImage = ''; selectedService = ''; payload = []; counter = 1; isAdd = false; subtotal = 0; discount = 0; totalPrice = 0; revision = 0; totalDuration = 0; finalNotes = '';
									spquantity = 0; spunitprice = 0; sptotal = 0; spdesc = ''; countls = 0;
									mpquantity = 0; mpunitprice = 0; mptotal = 0; mpdesc = '', mpdays = 0, countms = 0;
									$("#sp1title").empty();
									$(".set_offer_wrap .single_item").remove();
									$("#selectService_val").hide();
									$("#addrowerr").hide();
									$("#sp1do").val('');
									$("#sp1qty").val('');
									$("#sp1up").val('0');
									$("#sp1up").val('');
									$("#sp1tot").val('');
									$("#numDays").val('');
									$("#numRevisions").val('');
									$("#sp2discount").val('');
									$("#createdSingles").empty();
									$("#discountAlert").hide();
									$("#notesAlert").hide();
									$("#mp1_emp").hide();
									$("#mp1desc").val('');
									$("#mp1qty").val('0');
									$("#mp1up").val('0');
									$("#mp1up").val('');
									$("#mp1tot").val('');
									$("#mp1delivery").val('0');
									$("#totalMilestones").empty();
									$("#discAlert").hide();
									$("#mpfnoteAlert").hide();
									$("#sp2notes").val('');
									$("#mpfinalnotes").val('');
									//Deselecting choices
									//Remove Ticks
									$("input[name='theService']").attr("checked", false);
									$("input[name='theService']").parent().removeClass('active');
									$("input[name='paymentSystem']").attr("checked", false);
									$("input[name='paymentSystem']").parent().removeClass('active');
									//Remove Values and Added Button Data
									$("#serviceCon").removeAttr("data-target", "#singleMilestones");
									$("#serviceCon").removeAttr("data-dismiss", "modal");
									$("#continuepay").removeAttr("data-dismiss", "modal");
									$("#continuepay").removeAttr("data-target", "#singlePaymentSt1");
									$("#continuepay").removeAttr("data-target", "#milestonePaymentSt1");
									$("#sp1Con").removeAttr("data-target", "#singlePaymentSt2");
									$("#sp1Con").removeAttr("data-dismiss", "modal");
									//$("#chat-message").load(window.location.href + " #chat-message" );
									scrollToBottom();
								}
							});
							//Milestone
							$("#offerSend2").on('click', async function () {
								if (discount == 0 || finalNotes == '') {
									if (discount == 0) {
										$("#discAlert").show();
									}
									if (finalNotes == '') {
										$("#mpfnoteAlert").show();
									}
								}
								else {
									await socket.emit('sendOffer', {
										offer:
										{
											paymentType: paymentmethod,
											service: serviceID,
											tasks: payload,
											subTotal: subtotal.toFixed(2),
											revision,
											totalPrice: Number(totalPrice).toFixed(2),
											totalDuration,
											discount: Number(discount).toFixed(2),
											finalNotes,
											userBillingIndex,
											tax: Number(tax).toFixed(2)
										}
									});
									paymentmethod = ''; serviceID = ''; serviceImage = ''; selectedService = ''; payload = []; counter = 1; isAdd = false; subtotal = 0; discount = 0; totalPrice = 0; revision = 0; totalDuration = 0; finalNotes = '';
									spquantity = 0; spunitprice = 0; sptotal = 0; spdesc = ''; countls = 0;
									mpquantity = 0; mpunitprice = 0; mptotal = 0; mpdesc = '', mpdays = 0, countms = 0;
									$("#sp1title").empty();
									$("#mp1title").empty();
									$(".set_offer_wrap .single_item").remove();
									$("#selectService_val").hide();
									$("#addrowerr").hide();
									$("#sp1do").val('');
									$("#sp1qty").val('');
									$("#sp1up").val('0');
									$("#sp1up").val('');
									$("#sp1tot").val('');
									$("#numDays").val('');
									$("#numRevisions").val('');
									$("#sp2discount").val('');
									$("#createdSingles").empty();
									$("#discountAlert").hide();
									$("#notesAlert").hide();
									$("#mp1_emp").hide();
									$("#mp1desc").val('');
									$("#mp1qty").val('');
									$("#mp1up").val('0');
									$("#mp1up").val('');
									$("#mp1tot").val('');
									$("#mp1delivery").val('0');
									$("#totalMilestones").empty();
									$("#discAlert").hide();
									$("#mpfnoteAlert").hide();
									$("#sp2notes").val('');
									$("#mpfinalnotes").val('');
									//Deselecting choices
									//Remove Ticks
									$("input[name='theService']").attr("checked", false);
									$("input[name='theService']").parent().removeClass('active');
									$("input[name='paymentSystem']").attr("checked", false);
									$("input[name='paymentSystem']").parent().removeClass('active');
									//Remove Values and Added Button Data
									$("#serviceCon").removeAttr("data-target", "#singleMilestones");
									$("#serviceCon").removeAttr("data-dismiss", "modal");
									$("#continuepay").removeAttr("data-dismiss", "modal");
									$("#continuepay").removeAttr("data-target", "#singlePaymentSt1");
									$("#continuepay").removeAttr("data-target", "#milestonePaymentSt1");
									$("#sp1Con").removeAttr("data-target", "#singlePaymentSt2");
									$("#sp1Con").removeAttr("data-dismiss", "modal");
									$("#mp1Con").removeAttr("data-target", "#milestonePaymentSt2");
									$("#mp1Con").removeAttr("data-dismiss", "modal");
									//$("#chat-message").load(window.location.href + " #chat-message" );
									scrollToBottom();
									//chat-message
								}
							});
							$(document).on('hidden.bs.modal', function (e) {
								$(this).modal('hide').data('bs.modal', null);
							});
						});
					});
				</script>
				<script type="text/javascript">
					$(document).ready(function () {
						$('.sliding_search_wrap').on("click", (function (e) {
							$(".sliding_search_wrap").addClass("search_expanded");
							e.stopPropagation()
						}));
						$(document).on("click", function (e) {
							if ($(e.target).is(".sliding_search_wrap") === false && $(".form-control").val().length == 0) {
								$(".sliding_search_wrap").removeClass("search_expanded");
								$(".search_results_wrap").hide();
								$(".search_results_wrap .search_results .single_result").hide();
								$("#searchMessage").val('');
							}
						});
						$(".search_submit").click(function (e) {
							$(".form-control").each(function () {
								if ($(".form-control").val().length == 0) {
									e.preventDefault();
								}
							})
						});
					});
					// Force Body To Has Class Open For Modal
					$(document).on('hidden.bs.modal', function (event) {
						if ($('.modal:visible').length) {
							$('body').addClass('modal-open');
						}
					});
					$(document).ready(function () {
						$('#openMobileView').click(function () {
							$('.gb_chat_wrap').addClass('mobile_chat_layout');
						});
						$('.mobile_chat_layout_cancel').click(function () {
							$('.gb_chat_wrap').removeClass('mobile_chat_layout');
						});
					});
					//WORKING AS INTEDED
					//Search Function
					$(document).ready(function () {
						$("#contactSearch").on("keyup", function () {
							$(".single_result").show();
							var value = $(this).val().toLowerCase();
							$("#searchFilter li").filter(function () {
								$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
							});
						});
						$("#searchMessage").on("keyup", function () {
							if ($("#searchMessage").val() == '') {
								$(".search_results_wrap").hide();
							}
							else {
								$(".search_results_wrap").show();
							}
						});
						$("#searchMessage").on("keyup", function () {
							$(".search_results_wrap .search_results .single_result").show();
							var value = $(this).val().toLowerCase();
							$(".search_results_wrap .search_results .single_result").filter(function () {
								$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
							});
						});
					});
					function TaskSend() {
						try {
							let url = "/user/reminder";
							let newT = $("#taskData").val();
							let params = {
								reminder: newT,
							};
							CallAction(url, params, function (res) {
								console.log(res.Msg);
								$("#taskData").val(newT);
							});
						} catch (Err) {
							alert(Err);
						}
					}
					function noteSend() {
						try {
							let url = "/user/note";
							let newN = $("#noteData").val();
							let params = {
								notes: newN,
							};
							CallAction(url, params, function (res) {
								console.log(res.Msg);
								$("#noteData").val(newN);
							});
						} catch (Err) {
							alert(Err);
						}
					}
					function CallAction(RequestUri, Params, CallbackFunction, IsGet, IsContent) {
						try {
							$.ajax({
								type: ((IsGet == true) ? "GET" : "POST"),
								url: RequestUri,
								data: ((IsGet == true) ? "" : JSON.stringify(Params)),
								contentType: "application/json; charset=utf-8",
								dataType: ((IsContent == true) ? "html" : "json"),
								async: true,
								timeout: (1000 * 60 * 4),
								success: function (data) {
									CallbackFunction(data);
								},
								error: function (xhr) {
									console.log(xhr);
									alert("Something went wrong, please try again later or reload the page.");
								}
							});
						} catch (Err) {
							ShowError(Err);
						}
					}
				</script>
	</body>
	</html>
