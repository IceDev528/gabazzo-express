<%var serviceFee = 2.4;%>
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <!--Metatags-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatble" content="ie=edge" />
    <!--Website Title-->
    <title>Confirm & Pay</title>
    <!--Calling Favicon-->
    <link rel="icon" href="../images/payment/favicon.png" />
    <link rel="shortcut icon" href="../images/payment/favicon.ico" />
    <!--FontAwesome CDN-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
    />
    <!--Normalize v8.0.1 CSS FILE-->
    <link rel="stylesheet" href="../css/normalize.css" />
    <!--Bootstrap v4.6.0 CSS FILE-->
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <!--Gabazzo Common CSS File-->
    <link rel="stylesheet" href="../css/gabazzo.common.css" />
    <!--Fonts Are Loads From Here-->
    <link rel="stylesheet" href="../fonts/fonts.css" />
    <!--Main Stylesheet-->
    <link rel="stylesheet" href="../css/updatedStyles.css" />
    <!--Stylesheet For The Responsiveness-->
    <link rel="stylesheet" href="../css/responsive.css" />
    <!--Stylesheet For The Night Mode-->
    <link rel="stylesheet" href="../css/night.mode.css" />
    <script src="https://www.paypal.com/sdk/js?client-id=<%=paypalClientId%>&currency=USD"></script>
  </head>

  <body>
    <section class="pps_wrap" id="mainPage">
      <!--===== Markup For "Payment Header" Starts From Here =====-->
      <div class="pps_header_wrap">
        <div class="container">
          <div class="pps_header">
            <div class="pps_title">
              <h2>Order Details Single Payment</h2>
            </div>

            <div class="changing_mode">
              <a class="mode_icon" href="javascript:void(0)">
                <img
                  src="../images/payment/mode_icon_night.png"
                  class="img-fluid night_icon"
                  title="Night Mode"
                  data-toggle="tooltip"
                  alt=""
                />
                <img
                  src="../images/payment/mode_icon_day.png"
                  class="img-fluid day_icon"
                  title="Day Mode"
                  data-toggle="tooltip"
                  alt=""
                />
              </a>
            </div>
          </div>
        </div>
      </div>
      <!--===== Markup For "Payment Header" Ends Here =====-->

      <div class="pps_middle_wrap">
        <div class="container">
          <div class="pps_middle">
            <!--===== Markup For "Payment Options" Starts From Here =====-->
            <div class="left_details">
              <div class="payment_options_wrap">
                <div class="payment_options">
                  <h4>Payment Options:</h4>

                  <div class="payment_methods">
                    <div class="single_method">
                      <label class="radio">
                        <span>Credit & Debit Cards</span>
                        <input
                          type="radio"
                          id="credit-debit"
                          name="MethodSelection"
                        />
                        <div class="checkround"></div>
                        <div class="cards_icons">
                          <ul>
                            <li>
                              <a href="javascript:void(0)"
                                ><img
                                  src="../images/payment/Visa_icon.png"
                                  alt=""
                              /></a>
                            </li>
                            <li>
                              <a href="javascript:void(0)"
                                ><img
                                  src="../images/payment/American_Express_icon.png"
                                  alt=""
                              /></a>
                            </li>
                            <li>
                              <a href="javascript:void(0)"
                                ><img
                                  src="../images/payment/Discover_icon.png"
                                  alt=""
                              /></a>
                            </li>
                            <li>
                              <a href="javascript:void(0)"
                                ><img
                                  src="../images/payment/jcb_icon.png"
                                  alt=""
                              /></a>
                            </li>
                            <li>
                              <a href="javascript:void(0)">
                                <img
                                  src="../images/payment/Apple_Pay_icon.png"
                                  class="black_icon"
                                  alt=""
                                />
                                <img
                                  src="../images/payment/Apple_Pay_icon_white.png"
                                  class="white_icon"
                                  alt=""
                                />
                              </a>
                            </li>
                          </ul>
                        </div>
                      </label>
                      <div id="credit-debit-info">
                        <form action="">
                          <div class="form">
                            <div class="form_row_3">
                              <div class="form-group">
                                <label for="">Card Number</label>
                                <input
                                  id="cardNumber"
                                  type="text"
                                  class="form-control"
                                />
                              </div>
                              <div class="form-group">
                                <label for="">Expiry Date</label>
                                <input
                                  id="expiryDate"
                                  type="text"
                                  placeholder="MM/YY"
                                  class="form-control"
                                />
                              </div>
                              <div class="form-group">
                                <label for=""
                                  >Security Code
                                  <a
                                    href="javascript:void(0)"
                                    title="3 Digit Number on Back of Debit or Credit Card"
                                    data-toggle="tooltip"
                                    data-placement="top"
                                    ><i
                                      class="fa fa-question-circle"
                                      aria-hidden="true"
                                    ></i></a
                                ></label>
                                <input
                                  id="securityCode"
                                  type="text"
                                  class="form-control"
                                />
                              </div>
                            </div>

                            <div class="form_row_2">
                              <div class="form-group">
                                <label for="">First Name</label>
                                <input
                                  id="firstName"
                                  type="text"
                                  class="form-control"
                                />
                              </div>
                              <div class="form-group">
                                <label for="">Last Name</label>
                                <input
                                  id="lastName"
                                  type="text"
                                  class="form-control"
                                />
                              </div>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>

                    <div class="single_method">
                      <label class="radio">
                        <span>Paypal</span>
                        <img src="../images/payment/Paypal_icon.png" alt="" />
                        <input
                          type="radio"
                          id="paypal"
                          name="MethodSelection"
                        />
                        <div class="checkround"></div>
                      </label>
                      <div id="paypal-info">
                        <div
                          style="margin-top: 10px"
                          id="paypal-button-container"
                        ></div>
                        <!-- <form action="">
                          <div class="form-group">
                            <label for="">Email:</label>
                            <input type="email" class="form-control" />
                          </div>
                          <div class="form-group">
                            <label for="">Password:</label>
                            <input type="password" class="form-control" />
                          </div>
                          <div class="submit_button">
                            <button type="submit" class="btn gbtn">
                              Sign In
                            </button>
                          </div>
                        </form> -->
                      </div>
                    </div>

                    <div class="single_method">
                      <label class="radio">
                        <span>E-check</span>
                        <img src="../images/payment/E_Check_icon.png" alt="" />
                        <input
                          type="radio"
                          id="e-check"
                          name="MethodSelection"
                        />
                        <div class="checkround"></div>
                      </label>
                      <div id="e-check-info">
                        <form action="">
                          <h4>Amount to be paid $<%=offer?.totalCost%></h4>
                          <div class="form-group">
                            <label for="">Account Type*</label>
                            <select name="" id="" class="form-control" required>
                              <option value="">Checking Account</option>
                              <option value="">Savings Account</option>
                            </select>
                          </div>
                          <div class="form_row_2">
                            <div class="form-group">
                              <label for="">Routing Number*</label>
                              <input type="text" class="form-control" />
                            </div>
                            <div class="form-group">
                              <label for="">Account Number*</label>
                              <input type="text" class="form-control" />
                            </div>
                          </div>
                          <div class="form_row_2">
                            <div class="form-group">
                              <label for="">A/C Holder First Name*</label>
                              <input type="text" class="form-control" />
                            </div>
                            <div class="form-group">
                              <label for="">A/C Holder Last Name*</label>
                              <input type="text" class="form-control" />
                            </div>
                          </div>
                          <h6><b>*</b> Required Fields</h6>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!--===== Markup For "Payment Options" Ends Here =====-->

            <!--===== Markup For "Order Summary" Starts From Here =====-->
            <div class="sidebar_wrap">
              <div class="sidebar_box">
                <div class="cost_info">
                  <div class="cost_info_details">
                    <div class="service_img_title">
                      <div class="service_image grid_item">
                        <img
                          src="<%=service?.images[0]?.url%>"
                          class="img-fluid"
                          alt=""
                        />
                      </div>
                      <div class="service_title grid_item">
                        <h5><%=service?.title%></h5>
                      </div>
                    </div>

                    <div class="pricing_summary">
                      <div class="single_summary">
                        <h5>Subtotal</h5>
                        <h5 class="amount">$<%=offer?.subTotal%></h5>
                      </div>
                      <div class="single_summary">
                        <h5>
                          Service Fee
                          <a
                            href="javascript:void(0)"
                            title="This helps us to operate our Platform & build Customer Support for your orders."
                            data-toggle="tooltip"
                            data-placement="top"
                            ><i
                              class="fa fa-question-circle"
                              aria-hidden="true"
                            ></i
                          ></a>
                        </h5>
                        <h5 class="amount">
                          $<%=offer?.subTotal * (serviceFee/100)%>
                        </h5>
                      </div>
                      <div class="single_summary">
                        <h5>Discount</h5>
                        <h5 class="amount">$<%=offer?.discount%></h5>
                      </div>
                      <div class="single_summary total_price">
                        <h5>Total</h5>
                        <h5 class="amount">$<%=offer?.totalCost%></h5>
                      </div>
                    </div>
                    <script>
                      totalDuration = "<%=offer?.totalDuration%>";
                      offerId = "<%=offerId%>";
                      serviceFee = "<%=serviceFee%>";
                    </script>
                    <div class="continue_button">
                      <a
                        name="pay"
                        id="pay"
                        class="gbtn"
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        "
                      >
                        <div>Confirm & Pay</div>
                        <div
                          class="loader"
                          id="loader"
                          style="display: none"
                        ></div
                      ></a>
                    </div>
                  </div>
                </div>

                <div class="payment_info">
                  <h5><i class="fas fa-lock"></i> SSL Secured Payment</h5>
                  <h6>
                    Your Info Will Be Protected By <span>256-Bit</span> SSL
                    Encryption
                  </h6>
                </div>
              </div>
            </div>
            <!--===== Markup For "Order Summary" Ends Here =====-->
          </div>

          <!--===== Markup For "Info Texts" Starts From Here =====-->
          <div class="info_texts">
            <p>
              Payments are processed by Authorize.net and Gabazzo LLC.
              <a href="javascript:void(0)">See Payment Terms</a>.
            </p>
          </div>
          <!--===== Markup For "Info Texts" Ends Here =====-->
        </div>
      </div>
    </section>

    		<!--===== Markup For "Loading Page" Starts From Here =====-->
		<section class="loading_page_wrap" id="loader" style="display: none;">
			<div class="loding_page">
				<div class="loading_content">
					<div class="logo_slogan">
						<div class="logo">
							<img src="../../images/gabazzo_logo_black.png" class="img-fluid black_logo" alt="" />
							<img src="../../images/gabazzo_logo_white.png" class="img-fluid white_logo" alt="" />
						</div>
						<div class="slogan">
							<h4>Building Communities Together</h4>
						</div>
					</div>

					<div class="loading_texts">
						<div class="spinner-border" role="status">
							<span class="sr-only">Loading...</span>
						</div>
						<div class="texts">
							<h5>Please Wait...</h5>
							<p>We Are Processing Your Payment.</p>
						</div>
					</div>
				</div>
			</div>
		</section>
		<!--===== Markup For "Loading Page" Ends Here =====-->

    <!--===== Markup For "" Starts From Here =====-->
    <!--===== Markup For "" Ends Here =====-->

    <!--jQuery Main Libraty Latest Version-->
    <script type="text/javascript" src="../js/jquery-3.5.1.min.js"></script>
    <!--Bootstrap v4.5.3 JS File-->
    <script type="text/javascript" src="../js/popper.min.js"></script>
    <script type="text/javascript" src="../js/bootstrap.min.js"></script>
    <!--Custom Script JS File-->
    <script type="text/javascript" src="../js/updatedCustom.js"></script>
    <!--Custom JavaScript-->
    <script type="text/javascript">
      // Payment Option Selector
      $(function () {
        $("input[name=MethodSelection]")
          .on("click init-MethodSelection", function () {
            $("#credit-debit-info").toggle($("#credit-debit").prop("checked"));
          })
          .trigger("init-MethodSelection");
      });
      $(function () {
        $("input[name=MethodSelection]")
          .on("click init-MethodSelection", function () {
            $("#paypal-info").toggle($("#paypal").prop("checked"));
          })
          .trigger("init-MethodSelection");
      });
      $(function () {
        $("input[name=MethodSelection]")
          .on("click init-MethodSelection", function () {
            $("#e-check-info").toggle($("#e-check").prop("checked"));
          })
          .trigger("init-MethodSelection");
      });

      $(function () {
        $("a[name=pay]").on("click ", function () {

          // Showing the loader
          $("#mainPage").css("display", 'none')
          $("#loader").css("display", "grid" );

          var loader = document.getElementById("loader");
          var buttonPay = document.getElementById("pay");

          if ($("#credit-debit").prop("checked") == true) {
            var cardNumber = document.getElementById("cardNumber").value;
            var expiryDate = document.getElementById("expiryDate").value;
            var securityCode = document.getElementById("securityCode").value;
            var firstName = document.getElementById("firstName").value;
            var lastName = document.getElementById("lastName").value;
            loader.style.display = "block";
            buttonPay.style.pointerEvents = "none";
            $.ajax({
              method: "POST",
              url: "/user/payment-job",
              data: {
                card_holder_name: firstName + " " + lastName,
                card_number: cardNumber,
                card_expiry_month: expiryDate.split("/")[0],
                card_expiry_year: expiryDate.split("/")[1],
                cvv: securityCode,
                offer_id: offerId,
                finaldeliverydate: totalDuration,
              },
            })
              .done(function (data) {
                console.log("data", data);
                buttonPay.style.pointerEvents = "all";
                loader.style.display = "none";
                location.replace(
                  `/submit-work-requirements-single-payment/${data?.data?.jobId}`
                );
              })
              .fail(function (err) {
                buttonPay.style.pointerEvents = "all";
                loader.style.display = "none";
              });
          }
        });
      });
    </script>
    <script>
      var loader = document.getElementById("loader");
      var buttonPay = document.getElementById("pay");
      paypal
        .Buttons({
          style: {
            layout: "horizontal",
            color: "white",
            shape: "rect",
            label: "paypal",
          },
          // Sets up the transaction when a payment button is clicked
          createOrder: function (data, actions) {
            return fetch("/user/payment-job-paypal", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              cache: "no-cache",
              body: JSON.stringify({
                offer_id: offerId,
                serviceFee,
              }),
            })
              .then((res) => {
                loader.style.display = "block";
                buttonPay.style.pointerEvents = "none";
                if (res.ok) {
                  return res.json();
                }
                return res.json.then((json) => Promise.reject(json));
              })
              .then(({ id }) => {
                return id;
              })
              .catch((e) => {
                buttonPay.style.pointerEvents = "all";
                loader.style.display = "none";
                console.log(e.error);
                console.error(e.error);
              });
          },
          // Finalize the transaction after payer approval
          onApprove: function (data, actions) {
            return actions.order.capture().then(function (orderData) {
              // Successful capture! For dev/demo purposes:
              console.log("Capture result", JSON.stringify(orderData));
              var transaction =
                orderData.purchase_units[0].payments.captures[0];
              $.ajax({
                method: "POST",
                url: "/user/payment-job",
                data: {
                  payment_type: "paypal",
                  paypal_id: orderData.id,
                  offer_id: offerId,
                  finaldeliverydate: totalDuration,
                },
              })
                .done(function (data) {
                  console.log("data", data.data);
                  location.replace(
                    `/submit-work-requirements-single-payment/${data?.data?.jobId}`
                  );
                })
                .fail(function (err) {
                  // buttonPay.style.pointerEvents = "all";
                  // loader.style.display = "none";
                });

              // When ready to go live, remove the alert and show a success message within this page. For example:
              // var element = document.getElementById('paypal-button-container');
              // element.innerHTML = '';
              // element.innerHTML = '<h3>Thank you for your payment!</h3>';
              // Or go to another URL:  actions.redirect('thank_you.html');
            });
          },
        })
        .render("#paypal-button-container");
    </script>
  </body>
</html>
