<%var maxLength = 0;%>
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <!--Metatags-->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatble" content="ie=edge" />
    <!--Website Title-->
    <title>Submit Work Requirements</title>
    <!--Calling Favicon-->
    <link rel="icon" href="../images/payment/favicon.png" />
    <link rel="shortcut icon" href="../images/payment/favicon.ico" />
    <!--FontAwesome CDN-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
    />
    <!--Normalize v8.0.1 CSS FILE-->
    <link rel="stylesheet" href="../css/normalize.css" />
    <!--Bootstrap v4.6.0 CSS FILE-->
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <!--Gabazzo Common CSS File-->
    <link rel="stylesheet" href="../css/gabazzo.common.css" />
    <!--Fonts Are Loads From Here-->
    <link rel="stylesheet" href="../fonts/fonts.css" />
    <!--Main Stylesheet-->
    <link rel="stylesheet" href="../css/updatedStyles.css" />
    <!--Stylesheet For The Responsiveness-->
    <link rel="stylesheet" href="../css/responsive.css" />
    <!--Stylesheet For The Night Mode-->
    <link rel="stylesheet" href="../css/night.mode.css" />
  </head>

  <body>
    <section class="pps_wrap">
      <!--===== Markup For "Payment Header" Starts From Here =====-->
      <div class="pps_header_wrap">
        <div class="container">
          <div class="pps_header">
            <div class="pps_title">
              <h2>Order Details Single Payment</h2>
            </div>

            <div class="changing_mode">
              <a class="mode_icon" href="javascript:void(0)">
                <img
                  src="../images/payment/mode_icon_night.png"
                  class="img-fluid night_icon"
                  title="Night Mode"
                  data-toggle="tooltip"
                  alt=""
                />
                <img
                  src="../images/payment/mode_icon_day.png"
                  class="img-fluid day_icon"
                  title="Day Mode"
                  data-toggle="tooltip"
                  alt=""
                />
              </a>
            </div>
          </div>
        </div>
      </div>
      <!--===== Markup For "Payment Header" Ends Here =====-->

      <div class="pps_middle_wrap">
        <div class="container">
          <div
            class="alert alert-success alert-dismissible fade show"
            role="alert"
          >
            <div class="alert_contents">
              <div class="icon grid_item">
                <img
                  src="../images/payment/circle_check.png"
                  class="img-fluid"
                  alt=""
                />
              </div>
              <div class="texts">
                <h3>Thank you for your purchase!</h3>
                <h4>A receipt has been sent to your Email Address.</h4>
              </div>
            </div>
            <button
              type="button"
              class="close"
              data-dismiss="alert"
              aria-label="Close"
            >
              <img
                src="../images/payment/circle_times.png"
                class="img-fluid"
                alt=""
              />
            </button>
          </div>

          <div class="pps_middle">
            <!--===== Markup For "Submit Info" Starts From Here =====-->
            <div class="left_details">
              <div class="submit_info">
                <h4>Submit Work Requirements to Start Your Order.</h4>
                <form action="">
                  <div class="texts_box">
                    <div class="form-group">
                      <textarea
                        name=""
                        placeholder="Type a Brief Description Here..."
                        id="details"
                        cols="30"
                        rows="5"
                        class="form-control"
                      ></textarea>
                    </div>
                    <div class="attach_indicator">
                      <div class="attach_file">
                        <li
                          class="attachment gbtn"
                          id="upload_widget"
                          href="javascript:void(0)"
                        >
                          <a
                            ><i class="fa fa-paperclip" aria-hidden="true"></i>
                            Attach Files</a
                          >
                        </li>
                        <!-- <label class="attachment gbtn" id="upload_widget">
                          <img
                            src="../images/payment/attachment_icon_white.png"
                            class="img-fluid"
                            alt=""
                          />
                          <span>Attach Files</span>
                          <input
                            class="file_attachment"
                            id=""
                            name=""
                            type="file"
                          />
                        </label> -->
                      </div>
                      <div class="character_indicator">
                        <h5 id="detailsMaxCounter"><%=maxLength%>/2500</h5>
                      </div>
                    </div>
                  </div>

                  <div class="agreement_check">
                    <input
                      type="checkbox"
                      id="agreementCheck"
                      name="agreementCheck-1"
                      value=""
                    />
                    <label for="agreementCheck"
                      >The information I provided is accurate & complete. Any
                      changes will require contractor approval & may be
                      subjected to additional cost.</label
                    >
                  </div>

                  <div class="submit_buttons">
                    <ul>
                      <li>
                        <a class="btn gbtn gbtn_bdr" name="remindMeLater">
                          Remind Me Later
                        </a>
                      </li>
                      <li href="javascript:void(0)">
                        <a class="btn gbtn" name="startOrder"> Start Order </a>
                      </li>
                    </ul>
                  </div>
                </form>
              </div>
            </div>
            <!--===== Markup For "Submit Info" Ends Here =====-->

            <!--===== Markup For "Order Summary" Starts From Here =====-->
            <div class="sidebar_wrap">
              <div class="sidebar_box">
                <div class="cost_info">
                  <div class="cost_info_details">
                    <div class="service_img_title2">
                      <div class="service_image">
                        <img
                          src="<%=service?.images[0]?.url%>"
                          class="img-fluid"
                          alt=""
                        />
                      </div>
                      <div class="service_title">
                        <h5><%=service?.title%></h5>
                      </div>
                    </div>

                    <div class="pricing_summary">
                      <div class="single_summary">
                        <h5>Status:</h5>
                        <h5 class="amount">
                          <a href="javascript:void(0)"><%=job?.status%></a>
                          <script>
                            jobId = "<%=job?._id%>";
                          </script>
                        </h5>
                      </div>
                      <div class="single_summary">
                        <h5>PO #:</h5>
                        <h5 class="amount">
                          <a href="javascript:void(0)"><%= job?.receiptNo %></a>
                        </h5>
                      </div>
                      <div class="single_summary">
                        <h5>Invoice #:</h5>
                        <h5 class="amount">
                          <a href="javascript:void(0)"><%= offer?.invoiceNo %></a>
                        </h5>
                      </div>
                      <div class="single_summary">
                        <h5>Revision:</h5>
                        <h5 class="amount"><%=offer?.revision%></h5>
                      </div>
                      <div class="single_summary">
                        <h5>Delivery:</h5>
                        <h5 class="amount"><%=offer?.totalDuration%></h5>
                      </div>
                      <div class="single_summary">
                        <h5>Order Date:</h5>
                        <h5 class="amount"><%=date%></h5>
                      </div>
                      <div class="single_summary mb-0">
                        <h5>Total Paid:</h5>
                        <h5 class="amount">$<%=offer?.totalCost%></h5>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!--===== Markup For "Order Summary" Ends Here =====-->
          </div>
        </div>
      </div>
    </section>

    <!--===== Markup For "" Starts From Here =====-->
    <!--===== Markup For "" Ends Here =====-->

    <!--jQuery Main Libraty Latest Version-->
    <script type="text/javascript" src="../js/jquery-3.5.1.min.js"></script>
    <!--Bootstrap v4.5.3 JS File-->
    <script type="text/javascript" src="../js/popper.min.js"></script>
    <script type="text/javascript" src="../js/bootstrap.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.31.0/js/vendor/jquery.ui.widget.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.31.0/js/jquery.iframe-transport.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/10.31.0/js/jquery.fileupload.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cloudinary-jquery-file-upload/2.11.4/cloudinary-jquery-file-upload.js"></script>
    <script
      src="https://upload-widget.cloudinary.com/global/all.js"
      type="text/javascript"
    ></script>

    <!--Custom Script JS File-->
    <script type="text/javascript" src="../js/updatedCustom.js"></script>
    <!--Custom JavaScript-->
    <script type="text/javascript">
      $(document).ready(function () {
        $(".payment_options .toggle_button a").click(function () {
          $(".cards_icons").toggleClass("hide_icons");
          $(".toggle_button").toggleClass("rotate");
        });
      });

      let fileURL = [];
      var myWidget = cloudinary.createUploadWidget(
        {
          cloudName: "gabazzo",
          uploadPreset: "message_attachments",
        },
        (error, result) => {
          if (!error && result && result.event === "success") {
            console.log("Done! Here is the info: ", result.info);
            fileURL.push({
              url: result.info.secure_url,
              type: result.info.format,
            });
            $("#file_success").remove();
            $("#sending_options").append(
              '<li id="file_success" style="color: green"><span>Files are attached successfully.</span><li>'
            );
          }
          if (error) {
            console.log(error);
          }
          console.log("fileURL", fileURL);
        }
      );

      document.getElementById("upload_widget").addEventListener(
        "click",
        function () {
          myWidget.open();
        },
        false
      );

      $(document).ready(function () {
        $("#details").on("keyup", function (event) {
          maxLength = $("#details").val().length;
          $("#detailsMaxCounter").html(maxLength + "/2500");
        });
      });

      $(function () {
        $("a[name=startOrder]").on("click ", function () {
          var details = document.getElementById("details").value;
          if ($("#agreementCheck").prop("checked") == true && details !== "") {
            // alert("yes");
            $.ajax({
              method: "POST",
              url: "/user/add-desc",
              data: {
                description: details,
                attachment: fileURL,
                job_id: jobId,
              },
            }).done(function (data) {
              console.log("data", data);
              location.replace(`/activity/${jobId}`);
            });
          }
        });

        $("a[name=remindMeLater]").on("click ", function () {
          // alert("yes");
          $.ajax({
            method: "GET",
            url: `/user/remind-later/${jobId}`,
          }).done(function (data) {
            console.log("data", data);
            location.replace(`/manage-orders`);
          });
        });
      });
    </script>
  </body>
</html>
